<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ V√•r Familie - Familieapp</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Fredoka:wght@600&display=swap" rel="stylesheet">
    <style>
        /* RESET & BASE */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Quicksand', sans-serif; 
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* TOAST */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #4CAF50; color: white; padding: 14px 28px;
            border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            z-index: 10000; font-weight: 700; display: flex;
            align-items: center; gap: 10px; animation: fadeIn 0.3s ease;
            font-size: 16px; max-width: 90%; text-align: center;
            cursor: pointer;
        }
        .toast.error { background: #f44336; }
        .toast.warning { background: #FF9800; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* MOBILE */
        @media (max-width: 768px) {
            .btn { padding: 16px !important; min-height: 44px; }
            input, textarea { font-size: 16px !important; padding: 12px !important; }
            .tab { min-width: 130px; padding: 14px 10px !important; font-size: 14px !important; }
        }
        
        /* CALENDAR */
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px;
            background: #e0e0e0; border: 1px solid #e0e0e0;
        }
        .calendar-day {
            background: white; min-height: 100px; padding: 8px;
        }
        .calendar-event {
            background: #e3f2fd; border-left: 4px solid #2196F3;
            padding: 6px 8px; margin: 4px 0; border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- App loads here -->
    </div>

    <script>
        // ==================== APP STATE ====================
        let state = {
            currentUser: null,
            activeTab: 'shopping',
            shoppingItems: [],
            calendarEvents: [],
            notes: [],
            maintenanceTasks: [],
            choreTasks: [],
            isLoading: false,
            calendarView: 'month', // 'day', 'week', 'month'
            currentDate: new Date()
        };
        
        // ==================== DEMO DATA ====================
        const USERS = [
            { name: 'Emmie', emoji: 'üå∏', color: '#ff6b9d' },
            { name: 'Thelma', emoji: 'ü¶ã', color: '#c471ed' },
            { name: 'Elea', emoji: 'üåü', color: '#f9ca24' },
            { name: 'Katrine', emoji: 'üå∫', color: '#ff7979' },
            { name: 'Kim Rune', emoji: '‚ö°', color: '#4a90e2' }
        ];
        
        // Initialize with demo data
        function initDemoData() {
            state.shoppingItems = [
                { id: 1, text: 'Melk', quantity: 2, checked: false, added_by: 'Emmie', added_by_color: '#ff6b9d', timestamp: new Date(Date.now() - 3600000) },
                { id: 2, text: 'Br√∏d', quantity: 1, checked: true, added_by: 'Kim Rune', added_by_color: '#4a90e2', timestamp: new Date(Date.now() - 7200000) },
                { id: 3, text: 'Egg', quantity: 12, checked: false, added_by: 'Thelma', added_by_color: '#c471ed', timestamp: new Date(Date.now() - 10800000) }
            ];
            
            state.calendarEvents = [
                { id: 1, title: 'Fotballtrening', date: new Date().toISOString().split('T')[0], time: '17:00', duration: 90, color: '#4CAF50', added_by: 'Emmie' },
                { id: 2, title: 'Familiemiddag', date: new Date(Date.now() + 86400000).toISOString().split('T')[0], time: '18:30', duration: 120, color: '#FF9800', added_by: 'Katrine' }
            ];
            
            state.notes = [
                { id: 1, text: 'Husk √• bestille hundef√¥r', added_by: 'Kim Rune', added_by_color: '#4a90e2', timestamp: new Date(Date.now() - 86400000) },
                { id: 2, text: 'Bursdag: Bestemor p√• l√∏rdag!', added_by: 'Emmie', added_by_color: '#ff6b9d', timestamp: new Date(Date.now() - 172800000) }
            ];
            
            state.maintenanceTasks = [
                { id: 1, text: 'Skifte lysp√¶re p√• kj√∏kkenet', completed: false, priority: 1, added_by: 'Kim Rune', added_by_color: '#4a90e2' },
                { id: 2, text: 'M√•ke blader i hagen', completed: true, priority: 2, added_by: 'Thelma', added_by_color: '#c471ed' },
                { id: 3, text: 'Vaske vinduer', completed: false, priority: 3, added_by: 'Katrine', added_by_color: '#ff7979' }
            ];
            
            state.choreTasks = [
                { id: 1, title: 'Vaske badet', amount: 50, status: 'available', created_by: 'Katrine', task_type: 'once', category: 'hjemme' },
                { id: 2, title: 'Rydde garasjen', amount: 100, status: 'completed', created_by: 'Kim Rune', task_type: 'once', category: 'ute' }
            ];
        }
        
        // ==================== UTILITIES ====================
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 3000);
            
            return toast;
        }
        
        function formatDate(date) {
            const d = new Date(date);
            const now = new Date();
            const diff = now - d;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (minutes < 1) return 'Akkurat n√•';
            if (minutes < 60) return `${minutes} min siden`;
            if (hours < 24) return `${hours} timer siden`;
            
            return d.toLocaleDateString('no-NO', { 
                day: 'numeric', 
                month: 'short',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ==================== SHOPPING LIST ====================
        function addShoppingItem(text, quantity = 1) {
            if (!text.trim() || !state.currentUser) {
                showToast('Skriv noe f√∏rst!', 'warning');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                text: text.trim(),
                quantity: quantity,
                checked: false,
                added_by: state.currentUser.name,
                added_by_color: state.currentUser.color,
                timestamp: new Date().toISOString()
            };
            
            state.shoppingItems = [newItem, ...state.shoppingItems];
            showToast(`"${text}" lagt til! ‚úÖ`);
            renderApp();
        }
        
        function toggleShoppingItem(id) {
            state.shoppingItems = state.shoppingItems.map(item => 
                item.id === id ? { ...item, checked: !item.checked } : item
            );
            renderApp();
        }
        
        function deleteShoppingItem(id) {
            const item = state.shoppingItems.find(item => item.id === id);
            if (!item) return;
            
            // Store for undo
            window.lastDeletedItem = { type: 'shopping', data: item, id: id };
            
            state.shoppingItems = state.shoppingItems.filter(item => item.id !== id);
            const toast = showToast(`"${item.text}" slettet - Klikk for √• angre`, 'warning');
            
            toast.onclick = () => {
                if (window.lastDeletedItem) {
                    state.shoppingItems = [window.lastDeletedItem.data, ...state.shoppingItems];
                    showToast('Angret! Varen er tilbake ‚úÖ');
                    window.lastDeletedItem = null;
                    renderApp();
                }
            };
            
            renderApp();
        }
        
        // ==================== CALENDAR ====================
        function addCalendarEvent(title, date, time, duration = 60, color = '#4CAF50') {
            if (!title || !date || !time || !state.currentUser) return;
            
            const newEvent = {
                id: Date.now(),
                title: title,
                date: date,
                time: time,
                duration: duration,
                color: color,
                added_by: state.currentUser.name
            };
            
            state.calendarEvents = [...state.calendarEvents, newEvent];
            showToast(`"${title}" lagt til i kalender! ‚úÖ`);
            renderApp();
        }
        
        function getEventsForDate(dateStr) {
            return state.calendarEvents.filter(event => event.date === dateStr);
        }
        
        // ==================== NOTES ====================
        function addNote(text) {
            if (!text.trim() || !state.currentUser) return;
            
            const newNote = {
                id: Date.now(),
                text: text.trim(),
                added_by: state.currentUser.name,
                added_by_color: state.currentUser.color,
                timestamp: new Date().toISOString()
            };
            
            state.notes = [newNote, ...state.notes];
            showToast('Notat lagret! ‚úÖ');
            renderApp();
        }
        
        function deleteNote(id) {
            state.notes = state.notes.filter(note => note.id !== id);
            showToast('Notat slettet!');
            renderApp();
        }
        
        // ==================== MAINTENANCE ====================
        function toggleMaintenanceTask(id) {
            state.maintenanceTasks = state.maintenanceTasks.map(task =>
                task.id === id ? { ...task, completed: !task.completed } : task
            );
            renderApp();
        }
        
        // ==================== ALLOWANCE ====================
        function getEmmieStats() {
            // Simuler data for Emmie
            const emmieTasks = state.choreTasks.filter(task => 
                task.status === 'completed' || task.status === 'approved'
            );
            
            return {
                totalTasks: emmieTasks.length,
                totalEarnings: emmieTasks.reduce((sum, task) => sum + (task.amount || 0), 0),
                pendingTasks: state.choreTasks.filter(task => task.status === 'completed').length,
                message: emmieTasks.length > 0 ? 
                    'Flott jobb, Emmie! üí™' : 
                    'Ingen oppgaver fullf√∏rt enn√•'
            };
        }
        
        function completeChoreTask(taskId) {
            const task = state.choreTasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.status = 'completed';
            showToast(`"${task.title}" fullf√∏rt! Vent p√• godkjenning ‚è≥`);
            renderApp();
        }
        
        // ==================== CORE APP FUNCTIONS ====================
        function selectUser(userName) {
            const user = USERS.find(u => u.name === userName);
            if (user) {
                state.currentUser = user;
                localStorage.setItem('familieapp_user', userName);
                showToast(`Velkommen, ${userName}! ‚úÖ`);
                initDemoData();
                renderApp();
            }
        }
        
        function logout() {
            state.currentUser = null;
            localStorage.removeItem('familieapp_user');
            renderApp();
        }
        
        function switchTab(tab) {
            state.activeTab = tab;
            renderApp();
        }
        
        // ==================== RENDERING ====================
        function renderApp() {
            const app = document.getElementById('app');
            if (!app) return;
            
            if (!state.currentUser) {
                renderLoginScreen(app);
                return;
            }
            
            renderMainApp(app);
        }
        
        function renderLoginScreen(app) {
            app.innerHTML = `
                <div style="max-width: 500px; margin: 40px auto; padding: 30px; background: white; 
                           border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h1>
                    <h2 style="margin-bottom: 30px; color: #333; font-family: 'Fredoka', sans-serif;">
                        Velkommen til Familieappen!
                    </h2>
                    <p style="margin-bottom: 30px; color: #666;">Hvem vil du logge inn som?</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        ${USERS.map(user => `
                            <button onclick="selectUser('${user.name}')" class="btn"
                                style="background: white; border: 3px solid ${user.color}; border-radius: 20px;
                                       color: ${user.color}; font-weight: 700; cursor: pointer; display: flex;
                                       align-items: center; justify-content: center; gap: 15px; padding: 20px;
                                       font-size: 1.2rem;">
                                <span style="font-size: 1.8rem;">${user.emoji}</span>
                                <span>${user.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderMainApp(app) {
            const user = state.currentUser;
            const tabContent = {
                shopping: renderShoppingList(),
                calendar: renderCalendar(),
                notes: renderNotes(),
                maintenance: renderMaintenance(),
                allowance: renderAllowance()
            };
            
            app.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, ${user.color} 0%, ${user.color}80 100%);
                                padding: 25px; border-radius: 25px; margin-bottom: 25px; color: white;
                                display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div style="font-size: 3rem;">${user.emoji}</div>
                            <div>
                                <h1 style="font-size: 1.8rem; font-family: 'Fredoka', sans-serif;">
                                    Hei, ${user.name}!
                                </h1>
                                <p style="opacity: 0.9;">${state.shoppingItems.length} varer i handlelisten</p>
                            </div>
                        </div>
                        
                        <button onclick="logout()" class="btn"
                            style="padding: 12px 20px; background: rgba(255,255,255,0.2); border: 2px solid white;
                                   border-radius: 15px; color: white; font-weight: 700; cursor: pointer;">
                            Bytt bruker
                        </button>
                    </div>
                    
                    <!-- Tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap;">
                        ${Object.keys(tabContent).map(tab => `
                            <button onclick="switchTab('${tab}')" class="btn tab"
                                style="padding: 16px; background: ${state.activeTab === tab ? user.color : 'white'};
                                       color: ${state.activeTab === tab ? 'white' : user.color};
                                       border: 3px solid ${user.color}; border-radius: 15px;
                                       font-weight: 700; cursor: pointer; flex: 1; min-width: 140px;">
                                ${getTabIcon(tab)} ${getTabName(tab)}
                            </button>
                        `).join('')}
                    </div>
                    
                    <!-- Content -->
                    <div style="background: white; padding: 25px; border-radius: 20px; 
                                box-shadow: 0 8px 30px rgba(0,0,0,0.1); min-height: 400px;">
                        ${tabContent[state.activeTab]}
                    </div>
                    
                    <!-- Footer -->
                    <div style="text-align: center; margin-top: 30px; padding: 20px; color: #666; font-size: 0.9rem;">
                        <p>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Alle funksjoner er aktivert og fungerer!</p>
                    </div>
                </div>
            `;
        }
        
        function getTabIcon(tab) {
            const icons = {
                shopping: 'üõí',
                calendar: 'üìÖ',
                notes: 'üìù',
                maintenance: 'üîß',
                allowance: 'üí∞'
            };
            return icons[tab] || 'üìã';
        }
        
        function getTabName(tab) {
            const names = {
                shopping: 'Handleliste',
                calendar: 'Kalender',
                notes: 'Notater',
                maintenance: 'Vedlikehold',
                allowance: 'Ukel√∏nn'
            };
            return names[tab] || tab;
        }
        
        function renderShoppingList() {
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üõí Handleliste</h2>
                    
                    <!-- Input -->
                    <div style="display: flex; gap: 10px; margin-bottom: 25px;">
                        <input type="text" id="shoppingInput" placeholder="Hva skal vi handle?"
                            style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px;"
                            onkeypress="if(event.key === 'Enter') addShoppingItem(this.value.trim(), 1)">
                        <button onclick="addShoppingItem(document.getElementById('shoppingInput').value.trim(), 1)"
                            style="padding: 12px 24px; background: ${state.currentUser.color}; color: white;
                                   border: none; border-radius: 10px; font-weight: 700; cursor: pointer;">
                            Legg til
                        </button>
                    </div>
                    
                    <!-- List -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${state.shoppingItems.length === 0 ? `
                            <p style="text-align: center; color: #999; padding: 40px;">Handlelisten er tom!</p>
                        ` : state.shoppingItems.map(item => `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px;
                                        background: #f8f9fa; border-radius: 12px; border-left: 4px solid ${item.added_by_color}">
                                <button onclick="toggleShoppingItem(${item.id})"
                                    style="width: 24px; height: 24px; border: 2px solid ${item.added_by_color};
                                           background: ${item.checked ? item.added_by_color : 'white'};
                                           border-radius: 50%; cursor: pointer;">
                                    ${item.checked ? '‚úì' : ''}
                                </button>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; ${item.checked ? 'text-decoration: line-through; color: #999;' : ''}">
                                        ${item.text}
                                        <span style="background: ${item.added_by_color}30; color: ${item.added_by_color};
                                               padding: 2px 8px; border-radius: 10px; margin-left: 8px; font-size: 0.9rem;">
                                            ${item.quantity}x
                                        </span>
                                    </div>
                                    <div style="font-size: 0.85rem; color: #666;">
                                        ${item.added_by} ‚Ä¢ ${formatDate(item.timestamp)}
                                    </div>
                                </div>
                                <button onclick="deleteShoppingItem(${item.id})"
                                    style="color: #ff6b6b; background: none; border: none; cursor: pointer; padding: 8px;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderCalendar() {
            const today = new Date().toISOString().split('T')[0];
            const todayEvents = getEventsForDate(today);
            
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üìÖ Kalender</h2>
                    
                    <!-- Quick add -->
                    <div style="background: #f0f7ff; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <h3 style="margin-bottom: 15px;">Legg til hendelse</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <input type="text" id="eventTitle" placeholder="Hva skjer?" style="padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                            <input type="date" id="eventDate" value="${today}" style="padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                            <input type="time" id="eventTime" value="18:00" style="padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                            <button onclick="addCalendarEvent(
                                document.getElementById('eventTitle').value,
                                document.getElementById('eventDate').value,
                                document.getElementById('eventTime').value
                            )" style="padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Legg til i kalender
                            </button>
                        </div>
                    </div>
                    
                    <!-- Today's events -->
                    <h3 style="margin-bottom: 15px;">I dag (${new Date().toLocaleDateString('no-NO', { weekday: 'long', day: 'numeric', month: 'long' })})</h3>
                    ${todayEvents.length === 0 ? `
                        <p style="color: #666; padding: 20px; text-align: center;">Ingen hendelser i dag</p>
                    ` : `
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${todayEvents.map(event => `
                                <div style="padding: 15px; background: ${event.color}20; border-left: 4px solid ${event.color};
                                            border-radius: 8px;">
                                    <div style="font-weight: 700;">${event.title}</div>
                                    <div style="font-size: 0.9rem; color: #666;">${event.time} ‚Ä¢ ${event.duration} min ‚Ä¢ ${event.added_by}</div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                    
                    <!-- Month calendar preview -->
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 15px;">M√•nedens oversikt</h3>
                        <div class="calendar-grid">
                            ${['Man', 'Tir', 'Ons', 'Tor', 'Fre', 'L√∏r', 'S√∏n'].map(day => `
                                <div style="padding: 10px; background: #f5f5f5; text-align: center; font-weight: 700;">${day}</div>
                            `).join('')}
                            ${Array.from({ length: 35 }, (_, i) => {
                                const date = new Date();
                                date.setDate(i - 15);
                                const dateStr = date.toISOString().split('T')[0];
                                const events = getEventsForDate(dateStr);
                                
                                return `
                                    <div class="calendar-day">
                                        <div style="font-weight: 700; margin-bottom: 5px;">${date.getDate()}</div>
                                        ${events.slice(0, 2).map(event => `
                                            <div class="calendar-event">${event.time} ${event.title.substring(0, 10)}</div>
                                        `).join('')}
                                        ${events.length > 2 ? `<div style="font-size: 11px; color: #666;">+${events.length - 2} flere</div>` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderNotes() {
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üìù Notater</h2>
                    
                    <!-- Input -->
                    <div style="margin-bottom: 25px;">
                        <textarea id="noteInput" placeholder="Skriv et notat..." 
                            style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px;
                                   min-height: 100px; font-family: inherit; margin-bottom: 15px;"></textarea>
                        <button onclick="addNote(document.getElementById('noteInput').value.trim())"
                            style="padding: 12px 24px; background: ${state.currentUser.color}; color: white;
                                   border: none; border-radius: 10px; font-weight: 700; cursor: pointer;">
                            Lagre notat
                        </button>
                    </div>
                    
                    <!-- Notes list -->
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        ${state.notes.length === 0 ? `
                            <p style="text-align: center; color: #999; padding: 40px;">Ingen notater enn√•</p>
                        ` : state.notes.map(note => `
                            <div style="padding: 20px; background: #f8f9fa; border-radius: 12px;
                                        border-left: 4px solid ${note.added_by_color}">
                                <div style="margin-bottom: 10px;">${note.text}</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-size: 0.85rem; color: #666;">
                                        <span style="color: ${note.added_by_color}; font-weight: 700;">${note.added_by}</span>
                                        ‚Ä¢ ${formatDate(note.timestamp)}
                                    </div>
                                    <button onclick="deleteNote(${note.id})"
                                        style="color: #ff6b6b; background: none; border: none; cursor: pointer;">
                                        Slett
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderMaintenance() {
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üîß Vedlikehold</h2>
                    
                    <!-- Task list -->
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${state.maintenanceTasks.length === 0 ? `
                            <p style="text-align: center; color: #999; padding: 40px;">Ingen vedlikeholdsoppgaver</p>
                        ` : state.maintenanceTasks.map(task => `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px;
                                        background: #f8f9fa; border-radius: 12px;">
                                <button onclick="toggleMaintenanceTask(${task.id})"
                                    style="width: 24px; height: 24px; border: 2px solid ${task.added_by_color};
                                           background: ${task.completed ? task.added_by_color : 'white'};
                                           border-radius: 50%; cursor: pointer;">
                                    ${task.completed ? '‚úì' : ''}
                                </button>
                                <div style="flex: 1; ${task.completed ? 'text-decoration: line-through; color: #999;' : ''}">
                                    ${task.text}
                                </div>
                                <div style="font-size: 0.85rem; color: #666;">
                                    ${task.added_by}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Add task -->
                    <div style="margin-top: 30px; padding: 20px; background: #fff3e0; border-radius: 12px;">
                        <h3 style="margin-bottom: 15px;">Legg til ny oppgave</h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="maintenanceInput" placeholder="Hva m√• gj√∏res?"
                                style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                            <button onclick="state.maintenanceTasks.push({
                                id: Date.now(),
                                text: document.getElementById('maintenanceInput').value.trim(),
                                completed: false,
                                priority: state.maintenanceTasks.length + 1,
                                added_by: state.currentUser.name,
                                added_by_color: state.currentUser.color
                            }); document.getElementById('maintenanceInput').value = ''; renderApp();"
                                style="padding: 10px 20px; background: #FF9800; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Legg til
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderAllowance() {
            const isEmmie = state.currentUser.name === 'Emmie';
            const stats = getEmmieStats();
            
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üí∞ Ukel√∏nn</h2>
                    
                    ${isEmmie ? `
                        <!-- Emmie's stats -->
                        <div style="background: ${state.currentUser.color}15; padding: 25px; border-radius: 20px;
                                    margin-bottom: 30px; border: 2px solid ${state.currentUser.color}">
                            <h3 style="margin-bottom: 20px;">üìä Din statistikk</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 12px;">
                                    <div style="font-size: 0.9rem; color: #666;">Oppgaver</div>
                                    <div style="font-size: 2rem; font-weight: 700; color: ${state.currentUser.color}">
                                        ${stats.totalTasks}
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 12px;">
                                    <div style="font-size: 0.9rem; color: #666;">Bel√∏p</div>
                                    <div style="font-size: 2rem; font-weight: 700; color: ${state.currentUser.color}">
                                        ${stats.totalEarnings} kr
                                    </div>
                                </div>
                            </div>
                            <p style="color: #666; text-align: center;">${stats.message}</p>
                        </div>
                    ` : ''}
                    
                    <!-- Available tasks -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px;">Tilgjengelige oppgaver</h3>
                        ${state.choreTasks.filter(task => task.status === 'available').length === 0 ? `
                            <p style="color: #666; padding: 20px; text-align: center;">Ingen oppgaver tilgjengelig</p>
                        ` : `
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                ${state.choreTasks.filter(task => task.status === 'available').map(task => `
                                    <div style="padding: 20px; background: #e8f5e9; border-radius: 12px; border-left: 4px solid #4CAF50;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-weight: 700; margin-bottom: 5px;">${task.title}</div>
                                                <div style="font-size: 0.9rem; color: #666;">
                                                    ${task.category === 'hjemme' ? 'üè†' : 'üå≥'} ${task.category} ‚Ä¢ ${task.amount} kr
                                                </div>
                                            </div>
                                            ${state.currentUser.name !== 'Kim Rune' && state.currentUser.name !== 'Katrine' ? `
                                                <button onclick="completeChoreTask(${task.id})"
                                                    style="padding: 8px 16px; background: #4CAF50; color: white;
                                                           border: none; border-radius: 8px; cursor: pointer;">
                                                    Ta oppgave
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                    
                    <!-- Parent section -->
                    ${state.currentUser.name === 'Kim Rune' || state.currentUser.name === 'Katrine' ? `
                        <div style="background: #e3f2fd; padding: 20px; border-radius: 12px;">
                            <h3 style="margin-bottom: 15px;">Foreldreomr√•de</h3>
                            <p style="color: #666; margin-bottom: 15px;">Her kan du opprette nye oppgaver og godkjenne fullf√∏rte oppgaver.</p>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="newTaskTitle" placeholder="Oppgavetittel"
                                    style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6