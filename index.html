<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÃ¥r Familie - Familieapp</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Quicksand', sans-serif; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); min-height: 100vh; }
        
        /* Toast meldinger */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #4CAF50; color: white; padding: 12px 24px;
            border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999; font-weight: 600; display: flex;
            align-items: center; gap: 8px; animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* Mobilvennlig */
        @media (max-width: 768px) {
            .button { padding: 16px !important; min-height: 44px; }
            input, textarea { font-size: 16px !important; } /* Forhindrer zoom */
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;
        
        // SUPABASE KONFIGURASJON - BYTT UT MED DINN
        const SUPABASE_URL = 'https://tifhelbmaqoojqtqhzso.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpZmhlbGJtYXFvb2pxdHFoenNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE2MjQwNDEsImV4cCI6MjA0NzIwMDA0MX0.abc123'; // DU MÃ… BYTTE DENNE
        
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Feedback system
        const showToast = (message, type = 'success') => {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.background = type === 'success' ? '#4CAF50' : '#FF9800';
            toast.innerHTML = `${type === 'success' ? 'âœ…' : 'âš ï¸'} ${message}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };
        
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [shoppingItems, setShoppingItems] = useState([]);
            const [activeTab, setActiveTab] = useState('shopping');
            const [newItemText, setNewItemText] = useState('');
            
            const users = [
                { name: 'Emmie', emoji: 'ğŸŒ¸', color: '#ff6b9d' },
                { name: 'Thelma', emoji: 'ğŸ¦‹', color: '#c471ed' },
                { name: 'Elea', emoji: 'ğŸŒŸ', color: '#f9ca24' },
                { name: 'Katrine', emoji: 'ğŸŒº', color: '#ff7979' },
                { name: 'Kim Rune', emoji: 'âš¡', color: '#4a90e2' }
            ];
            
            // Last data
            useEffect(() => {
                loadShoppingItems();
            }, []);
            
            const loadShoppingItems = async () => {
                const { data } = await supabaseClient
                    .from('shopping_items')
                    .select('*')
                    .order('timestamp', { ascending: false });
                if (data) setShoppingItems(data);
            };
            
            const addShoppingItem = async () => {
                if (!newItemText.trim() || !currentUser) return;
                
                const newItem = {
                    text: newItemText,
                    quantity: 1,
                    added_by: currentUser.name,
                    added_by_color: currentUser.color
                };
                
                const { data } = await supabaseClient
                    .from('shopping_items')
                    .insert([newItem])
                    .select()
                    .single();
                
                if (data) {
                    setShoppingItems([data, ...shoppingItems]);
                    setNewItemText('');
                    showToast('Vare lagt til! âœ…');
                }
            };
            
            const deleteShoppingItem = async (id) => {
                await supabaseClient
                    .from('shopping_items')
                    .delete()
                    .eq('id', id);
                
                setShoppingItems(shoppingItems.filter(item => item.id !== id));
                showToast('Vare slettet! [Klikk her for Ã¥ angre]', 'undo');
                // Her kan du legge til undo-logikk
            };
            
            if (!currentUser) {
                return (
                    <div style={{ padding: 20, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '100vh' }}>
                        <h1 style={{ marginBottom: 30 }}>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Velkommen til Familieappen!</h1>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: 15, maxWidth: 400, width: '100%' }}>
                            {users.map(user => (
                                <button
                                    key={user.name}
                                    onClick={() => setCurrentUser(user)}
                                    style={{
                                        padding: '20px',
                                        background: 'white',
                                        border: `3px solid ${user.color}`,
                                        borderRadius: 20,
                                        fontSize: '1.2rem',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '15px'
                                    }}
                                >
                                    <span style={{ fontSize: '1.8rem' }}>{user.emoji}</span>
                                    <span>{user.name}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }
            
            return (
                <div style={{ padding: 20 }}>
                    {/* Header */}
                    <div style={{ 
                        background: `linear-gradient(135deg, ${currentUser.color}40 0%, ${currentUser.color}80 100%)`,
                        padding: '20px',
                        borderRadius: 20,
                        marginBottom: 20,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 15 }}>
                            <span style={{ fontSize: '2rem' }}>{currentUser.emoji}</span>
                            <div>
                                <h1 style={{ color: '#333' }}>Hei, {currentUser.name}!</h1>
                                <p style={{ color: '#666', fontSize: '0.9rem' }}>Velkommen til familieappen</p>
                            </div>
                        </div>
                        <button
                            onClick={() => setCurrentUser(null)}
                            style={{
                                padding: '10px 15px',
                                background: 'white',
                                border: `2px solid ${currentUser.color}`,
                                borderRadius: 10,
                                color: currentUser.color,
                                fontWeight: '600',
                                cursor: 'pointer'
                            }}
                        >
                            Bytt bruker
                        </button>
                    </div>
                    
                    {/* Tabs */}
                    <div style={{ display: 'flex', gap: 10, marginBottom: 20, flexWrap: 'wrap' }}>
                        {['shopping', 'calendar', 'notes', 'maintenance', 'allowance'].map(tab => (
                            <button
                                key={tab}
                                onClick={() => setActiveTab(tab)}
                                style={{
                                    padding: '15px',
                                    background: activeTab === tab ? currentUser.color : 'white',
                                    color: activeTab === tab ? 'white' : currentUser.color,
                                    border: `2px solid ${currentUser.color}`,
                                    borderRadius: 15,
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    flex: 1,
                                    minWidth: 140
                                }}
                            >
                                {tab === 'shopping' && 'ğŸ›’ Handleliste'}
                                {tab === 'calendar' && 'ğŸ“… Kalender'}
                                {tab === 'notes' && 'ğŸ“ Notater'}
                                {tab === 'maintenance' && 'ğŸ”§ Vedlikehold'}
                                {tab === 'allowance' && 'ğŸ’° UkelÃ¸nn'}
                            </button>
                        ))}
                    </div>
                    
                    {/* Innhold */}
                    <div style={{ background: 'white', padding: 20, borderRadius: 20, boxShadow: '0 4px 15px rgba(0,0,0,0.1)' }}>
                        {activeTab === 'shopping' && (
                            <div>
                                <h2 style={{ marginBottom: 15 }}>ğŸ›’ Handleliste</h2>
                                
                                {/* Input for ny vare */}
                                <div style={{ display: 'flex', gap: 10, marginBottom: 20 }}>
                                    <input
                                        type="text"
                                        placeholder="Hva skal vi handle?"
                                        value={newItemText}
                                        onChange={(e) => setNewItemText(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addShoppingItem()}
                                        style={{
                                            flex: 1,
                                            padding: 15,
                                            border: `2px solid ${currentUser.color}40`,
                                            borderRadius: 15,
                                            fontSize: '1rem'
                                        }}
                                    />
                                    <button
                                        onClick={addShoppingItem}
                                        style={{
                                            padding: '15px 25px',
                                            background: currentUser.color,
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: 15,
                                            fontWeight: '600',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Legg til
                                    </button>
                                </div>
                                
                                {/* Handleliste */}
                                <div style={{ display: 'flex', flexDirection: 'column', gap: 10 }}>
                                    {shoppingItems.length === 0 ? (
                                        <p style={{ textAlign: 'center', color: '#999', padding: 40 }}>
                                            Handlelisten er tom! ğŸ›’
                                        </p>
                                    ) : (
                                        shoppingItems.map(item => (
                                            <div
                                                key={item.id}
                                                style={{
                                                    padding: 15,
                                                    background: '#f9f9f9',
                                                    borderRadius: 15,
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    borderLeft: `4px solid ${item.added_by_color || currentUser.color}`
                                                }}
                                            >
                                                <div>
                                                    <div style={{ fontWeight: '600' }}>{item.text}</div>
                                                    <div style={{ fontSize: '0.8rem', color: '#666', marginTop: 5 }}>
                                                        {item.added_by} â€¢ {new Date(item.timestamp).toLocaleDateString('no-NO')}
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => deleteShoppingItem(item.id)}
                                                    style={{
                                                        padding: '8px 12px',
                                                        background: '#ff6b6b',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: 8,
                                                        cursor: 'pointer',
                                                        fontWeight: '600'
                                                    }}
                                                >
                                                    Slett
                                                </button>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'calendar' && (
                            <div>
                                <h2 style={{ marginBottom: 15 }}>ğŸ“… Kalender</h2>
                                <p style={{ color: '#666' }}>Kalender kommer snart...</p>
                            </div>
                        )}
                        
                        {activeTab === 'allowance' && (
                            <div>
                                <h2 style={{ marginBottom: 15 }}>ğŸ’° UkelÃ¸nn</h2>
                                
                                {/* Statistikk test for Emmie */}
                                {currentUser.name === 'Emmie' && (
                                    <div style={{
                                        background: `${currentUser.color}20`,
                                        padding: 20,
                                        borderRadius: 15,
                                        marginBottom: 20
                                    }}>
                                        <h3>ğŸ“Š Din statistikk</h3>
                                        <div style={{ marginTop: 10 }}>
                                            <div>âœ… <strong>1 oppgave</strong> fullfÃ¸rt</div>
                                            <div>ğŸ’° <strong>50 kr</strong> venter pÃ¥ godkjenning</div>
                                            <div>ğŸ¯ <strong>FÃ¸rste prestasjon</strong> lÃ¥st opp!</div>
                                        </div>
                                        <button
                                            onClick={() => showToast('Statistikk lastet! Emmie har 1 oppgave âœ…')}
                                            style={{
                                                marginTop: 15,
                                                padding: '10px 15px',
                                                background: currentUser.color,
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: 10,
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Test statistikk
                                        </button>
                                    </div>
                                )}
                                
                                <p style={{ color: '#666' }}>UkelÃ¸nnssystem kommer snart...</p>
                            </div>
                        )}
                    </div>
                    
                    {/* Footer */}
                    <div style={{ textAlign: 'center', marginTop: 30, color: '#666', fontSize: '0.9rem' }}>
                        <p>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Alt deles med hele familien</p>
                    </div>
                </div>
            );
        }
        
        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Test funksjoner
        window.testToast = () => showToast('Testmelding! âœ…');
        window.showStats = () => {
            if (window.reactApp?.currentUser?.name === 'Emmie') {
                showToast('Emmie har 1 oppgave fullfÃ¸rt âœ…');
            } else {
                showToast('Logg inn som Emmie for Ã¥ teste statistikk', 'warning');
            }
        };
    </script>
</body>
</html>