<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ V√•r Familie - Familieapp</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Fredoka:wght@600&display=swap" rel="stylesheet">
    <style>
        /* RESET & BASE */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Quicksand', sans-serif; 
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* TOAST */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #4CAF50; color: white; padding: 14px 28px;
            border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            z-index: 10000; font-weight: 700; display: flex;
            align-items: center; gap: 10px; animation: fadeIn 0.3s ease;
            font-size: 16px; max-width: 90%; text-align: center;
        }
        .toast.error { background: #f44336; }
        .toast.warning { background: #FF9800; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* MOBILE */
        @media (max-width: 768px) {
            .btn { padding: 18px !important; min-height: 50px; }
            input { font-size: 17px !important; padding: 16px !important; }
        }
        
        /* LOADING */
        .loader {
            display: inline-block; width: 30px; height: 30px;
            border: 4px solid #f3f3f3; border-top: 4px solid #4CAF50;
            border-radius: 50%; animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- App loads here -->
    </div>

    <script>
        // ==================== APP STATE ====================
        let appState = {
            currentUser: null,
            activeTab: 'shopping',
            shoppingItems: [],
            isLoading: false
        };
        
        // ==================== DEMO DATA ====================
        const DEMO_USERS = [
            { name: 'Emmie', emoji: 'üå∏', color: '#ff6b9d' },
            { name: 'Thelma', emoji: 'ü¶ã', color: '#c471ed' },
            { name: 'Elea', emoji: 'üåü', color: '#f9ca24' },
            { name: 'Katrine', emoji: 'üå∫', color: '#ff7979' },
            { name: 'Kim Rune', emoji: '‚ö°', color: '#4a90e2' }
        ];
        
        const DEMO_ITEMS = [
            { id: 1, text: 'Melk', quantity: 2, added_by: 'Emmie', added_by_color: '#ff6b9d', timestamp: new Date(Date.now() - 3600000) },
            { id: 2, text: 'Br√∏d', quantity: 1, added_by: 'Kim Rune', added_by_color: '#4a90e2', timestamp: new Date(Date.now() - 7200000) },
            { id: 3, text: 'Egg', quantity: 12, added_by: 'Thelma', added_by_color: '#c471ed', timestamp: new Date(Date.now() - 10800000) }
        ];
        
        // ==================== UTILITIES ====================
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 3000);
        }
        
        function formatDate(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (minutes < 1) return 'Akkurat n√•';
            if (minutes < 60) return `${minutes} min siden`;
            if (hours < 24) return `${hours} timer siden`;
            
            return new Date(date).toLocaleDateString('no-NO', { 
                day: 'numeric', 
                month: 'short',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ==================== CORE FUNCTIONS ====================
        function addItem(text, quantity = 1) {
            if (!text.trim() || !appState.currentUser) {
                showToast('Skriv noe f√∏rst!', 'warning');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                text: text.trim(),
                quantity: quantity,
                added_by: appState.currentUser.name,
                added_by_color: appState.currentUser.color,
                timestamp: new Date().toISOString()
            };
            
            appState.shoppingItems = [newItem, ...appState.shoppingItems];
            showToast(`"${text}" lagt til! ‚úÖ`);
            renderApp();
        }
        
        function deleteItem(id) {
            const item = appState.shoppingItems.find(item => item.id === id);
            if (!item) return;
            
            // Store for undo
            window.lastDeletedItem = { item: item, id: id };
            
            appState.shoppingItems = appState.shoppingItems.filter(item => item.id !== id);
            showToast(`"${item.text}" slettet - Klikk for √• angre`, 'warning');
            
            // Make toast clickable for undo
            setTimeout(() => {
                const toast = document.querySelector('.toast');
                if (toast) {
                    toast.style.cursor = 'pointer';
                    toast.onclick = () => {
                        if (window.lastDeletedItem) {
                            appState.shoppingItems = [window.lastDeletedItem.item, ...appState.shoppingItems];
                            showToast('Angret! Varen er tilbake ‚úÖ');
                            window.lastDeletedItem = null;
                            renderApp();
                        }
                    };
                }
            }, 100);
            
            renderApp();
        }
        
        function switchTab(tab) {
            appState.activeTab = tab;
            renderApp();
        }
        
        function selectUser(userName) {
            const user = DEMO_USERS.find(u => u.name === userName);
            if (user) {
                appState.currentUser = user;
                localStorage.setItem('familieapp_user', userName);
                showToast(`Velkommen, ${userName}! ‚úÖ`);
                
                // Load demo data for this user
                appState.shoppingItems = [...DEMO_ITEMS];
                renderApp();
            }
        }
        
        function logout() {
            appState.currentUser = null;
            localStorage.removeItem('familieapp_user');
            renderApp();
        }
        
        // ==================== EMMIE STATISTICS ====================
        function getEmmieStats() {
            return {
                tasksCompleted: 1,
                totalEarnings: 50,
                pendingApproval: 1,
                message: "Emmie har 1 oppgave fullf√∏rt p√• 50 kr, venter p√• godkjenning!"
            };
        }
        
        function showEmmieStatsPopup() {
            const stats = getEmmieStats();
            alert(`üìä EMMIES STATISTIKK\n\n` +
                  `‚úÖ Oppgaver fullf√∏rt: ${stats.tasksCompleted}\n` +
                  `üí∞ Bel√∏p: ${stats.totalEarnings} kr\n` +
                  `‚è≥ Venter godkjenning: ${stats.pendingApproval}\n\n` +
                  `${stats.message}`);
            showToast('Statistikk vist! ‚úÖ');
        }
        
        // ==================== RENDERING ====================
        function renderApp() {
            const app = document.getElementById('app');
            if (!app) return;
            
            // Show login screen if no user
            if (!appState.currentUser) {
                app.innerHTML = renderLoginScreen();
                return;
            }
            
            // Show main app
            app.innerHTML = renderMainApp();
        }
        
        function renderLoginScreen() {
            return `
                <div style="max-width: 500px; margin: 40px auto; padding: 30px; background: white; 
                           border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h1>
                    <h2 style="margin-bottom: 30px; color: #333; font-family: 'Fredoka', sans-serif;">
                        Velkommen til Familieappen!
                    </h2>
                    <p style="margin-bottom: 30px; color: #666;">Hvem vil du logge inn som?</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        ${DEMO_USERS.map(user => `
                            <button onclick="selectUser('${user.name}')" class="btn"
                                style="background: white; border: 3px solid ${user.color}; border-radius: 20px;
                                       color: ${user.color}; font-weight: 700; cursor: pointer; display: flex;
                                       align-items: center; justify-content: center; gap: 15px; padding: 20px;
                                       transition: all 0.2s; font-size: 1.2rem;"
                                onmouseover="this.style.background='${user.color}20'"
                                onmouseout="this.style.background='white'">
                                <span style="font-size: 1.8rem;">${user.emoji}</span>
                                <span>${user.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderMainApp() {
            const user = appState.currentUser;
            
            return `
                <div style="max-width: 800px; margin: 0 auto;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, ${user.color} 0%, ${user.color}80 100%);
                                padding: 25px; border-radius: 25px; margin-bottom: 25px; color: white;
                                display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div style="font-size: 3rem;">${user.emoji}</div>
                            <div>
                                <h1 style="font-size: 1.8rem; font-family: 'Fredoka', sans-serif;">
                                    Hei, ${user.name}!
                                </h1>
                                <p style="opacity: 0.9;">${appState.shoppingItems.length} varer i handlelisten</p>
                            </div>
                        </div>
                        
                        <button onclick="logout()" class="btn"
                            style="padding: 12px 20px; background: rgba(255,255,255,0.2); border: 2px solid white;
                                   border-radius: 15px; color: white; font-weight: 700; cursor: pointer; font-size: 16px;">
                            Bytt bruker
                        </button>
                    </div>
                    
                    <!-- Tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap;">
                        ${['shopping', 'calendar', 'notes', 'maintenance', 'allowance'].map(tab => `
                            <button onclick="switchTab('${tab}')" class="btn"
                                style="padding: 18px; background: ${appState.activeTab === tab ? user.color : 'white'};
                                       color: ${appState.activeTab === tab ? 'white' : user.color};
                                       border: 3px solid ${user.color}; border-radius: 18px;
                                       font-weight: 700; cursor: pointer; flex: 1; min-width: 150px; font-size: 16px;">
                                ${getTabIcon(tab)} ${getTabName(tab)}
                            </button>
                        `).join('')}
                    </div>
                    
                    <!-- Content -->
                    <div style="background: white; padding: 30px; border-radius: 25px; 
                                box-shadow: 0 8px 30px rgba(0,0,0,0.1); min-height: 400px;">
                        ${renderTabContent()}
                    </div>
                    
                    <!-- Footer -->
                    <div style="text-align: center; margin-top: 40px; padding: 20px; color: #666; font-size: 0.9rem;">
                        <p>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familien: Emmie ‚Ä¢ Thelma ‚Ä¢ Elea ‚Ä¢ Katrine ‚Ä¢ Kim Rune</p>
                        <p style="margin-top: 5px; opacity: 0.7;">Demo versjon ‚Ä¢ Fungerer offline</p>
                    </div>
                </div>
            `;
        }
        
        function getTabIcon(tab) {
            const icons = {
                shopping: 'üõí',
                calendar: 'üìÖ',
                notes: 'üìù',
                maintenance: 'üîß',
                allowance: 'üí∞'
            };
            return icons[tab] || 'üìã';
        }
        
        function getTabName(tab) {
            const names = {
                shopping: 'Handleliste',
                calendar: 'Kalender',
                notes: 'Notater',
                maintenance: 'Vedlikehold',
                allowance: 'Ukel√∏nn'
            };
            return names[tab] || tab;
        }
        
        function renderTabContent() {
            switch(appState.activeTab) {
                case 'shopping':
                    return renderShoppingList();
                case 'calendar':
                    return `<div style="text-align: center; padding: 60px;">
                              <div style="font-size: 4rem; margin-bottom: 20px;">üìÖ</div>
                              <h3>Kalender kommer snart!</h3>
                            </div>`;
                case 'allowance':
                    return renderAllowance();
                default:
                    return `<div style="text-align: center; padding: 60px;">
                              <div style="font-size: 4rem; margin-bottom: 20px;">${getTabIcon(appState.activeTab)}</div>
                              <h3>${getTabName(appState.activeTab)} kommer snart!</h3>
                            </div>`;
            }
        }
        
        function renderShoppingList() {
            return `
                <div>
                    <h2 style="font-size: 1.8rem; color: #333; margin-bottom: 25px;">üõí Handleliste</h2>
                    
                    <!-- Input -->
                    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                        <input type="text" id="newItemInput" placeholder="Hva skal vi handle? (trykk Enter)"
                            class="mobile-input" style="flex: 1; border: 3px solid ${appState.currentUser.color}40;
                            border-radius: 18px; font-size: 17px; outline: none; padding: 16px;"
                            onkeypress="if(event.key === 'Enter') addNewItem()">
                        <button onclick="addNewItem()" class="btn"
                            style="background: ${appState.currentUser.color}; color: white; border: none;
                            border-radius: 18px; font-weight: 700; cursor: pointer; min-width: 120px; padding: 18px;">
                            Legg til
                        </button>
                    </div>
                    
                    <!-- List -->
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        ${appState.shoppingItems.length === 0 ? `
                            <div style="text-align: center; padding: 50px; color: #999;">
                                <div style="font-size: 4rem; margin-bottom: 20px;">üõí</div>
                                <p style="font-size: 1.2rem;">Handlelisten er tom!</p>
                                <p>Legg til den f√∏rste varen over üëÜ</p>
                            </div>
                        ` : appState.shoppingItems.map(item => `
                            <div style="padding: 20px; background: #f8f9fa; border-radius: 18px;
                                        display: flex; justify-content: space-between; align-items: center;
                                        border-left: 6px solid ${item.added_by_color || appState.currentUser.color};">
                                <div style="flex: 1;">
                                    <div style="font-size: 1.3rem; font-weight: 700; color: #333; margin-bottom: 5px;">
                                        ${item.text}
                                        ${item.quantity > 1 ? `
                                            <span style="background: ${appState.currentUser.color}30; 
                                                   color: ${appState.currentUser.color}; padding: 4px 10px; 
                                                   border-radius: 10px; margin-left: 10px; font-size: 0.9rem;">
                                                ${item.quantity}x
                                            </span>
                                        ` : ''}
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666;">
                                        <span style="color: ${item.added_by_color || appState.currentUser.color}; font-weight: 700;">
                                            ${item.added_by}
                                        </span>
                                        ‚Ä¢ ${formatDate(item.timestamp)}
                                    </div>
                                </div>
                                <button onclick="deleteItem(${item.id})" class="btn"
                                    style="padding: 10px 20px; background: #ff6b6b; color: white; border: none;
                                           border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 15px;">
                                    Slett
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderAllowance() {
            const isEmmie = appState.currentUser.name === 'Emmie';
            
            return `
                <div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 20px;">üí∞ Ukel√∏nn</h2>
                    
                    ${isEmmie ? `
                        <div style="background: ${appState.currentUser.color}15; padding: 25px; border-radius: 20px;
                                    margin-bottom: 30px; border: 3px solid ${appState.currentUser.color}">
                            <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <span>üìä</span>
                                <span>Emmies Statistikk</span>
                            </h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 15px;">
                                    <div style="font-size: 0.9rem; color: #666;">Oppgaver</div>
                                    <div style="font-size: 2.5rem; font-weight: 700; color: ${appState.currentUser.color}">1</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 15px;">
                                    <div style="font-size: 0.9rem; color: #666;">Bel√∏p</div>
                                    <div style="font-size: 2.5rem; font-weight: 700; color: ${appState.currentUser.color}">50 kr</div>
                                </div>
                            </div>
                            <button onclick="showEmmieStatsPopup()" class="btn"
                                style="background: ${appState.currentUser.color}; color: white; border: none;
                                       border-radius: 15px; font-weight: 700; cursor: pointer; width: 100%; padding: 18px;">
                                üìà Vis detaljert statistikk
                            </button>
                        </div>
                    ` : ''}
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <p style="color: #666; margin-bottom: 15px;">
                            <strong>Ukel√∏nnssystemet kommer snart!</strong>
                        </p>
                        <p style="color: #666; font-size: 0.95rem;">
                            Her kan barn ta oppgaver, tjene penger og se statistikk.
                            Foreldre kan opprette oppgaver og godkjenne utf√∏rt arbeid.
                        </p>
                    </div>
                </div>
            `;
        }
        
        // ==================== GLOBAL FUNCTIONS ====================
        window.addNewItem = function() {
            const input = document.getElementById('newItemInput');
            if (!input) return;
            
            addItem(input.value.trim());
            input.value = '';
            input.focus();
        };
        
        // Make core functions available globally
        window.addItem = addItem;
        window.deleteItem = deleteItem;
        window.switchTab = switchTab;
        window.selectUser = selectUser;
        window.logout = logout;
        window.showEmmieStatsPopup = showEmmieStatsPopup;
        window.showToast = showToast;
        
        // ==================== INITIALIZATION ====================
        function initApp() {
            console.log('üöÄ Familieapp starter...');
            
            // Check for saved user
            const savedUser = localStorage.getItem('familieapp_user');
            if (savedUser) {
                selectUser(savedUser);
            } else {
                renderApp();
            }
            
            // Add test functions
            window.testApp = function() {
                showToast('App testet! ‚úÖ');
                console.log('‚úÖ App er oppe og g√•r');
                console.log('üìä Test Emmies statistikk: showEmmieStatsPopup()');
                console.log('üõí Test handleliste: Legg til noe i input-feltet');
            };
            
            console.log('‚úÖ App klar! Test med: testApp()');
        }
        
        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Also start immediately (in case DOM already loaded)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>