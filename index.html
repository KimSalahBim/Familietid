<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√•r Familie - Familieapp</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Quicksand', sans-serif; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); min-height: 100vh; padding: 20px; }
        
        /* Toast */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #4CAF50; color: white; padding: 14px 28px;
            border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            z-index: 9999; font-weight: 700; display: flex;
            align-items: center; gap: 10px; animation: fadeIn 0.3s ease;
            font-size: 16px; max-width: 90%; text-align: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* Mobil */
        .mobile-button { padding: 18px !important; min-height: 50px; font-size: 17px !important; }
        .mobile-input { font-size: 17px !important; padding: 16px !important; }
        
        @media (max-width: 768px) {
            .container { padding: 10px !important; }
            .tab-button { min-width: 120px; padding: 16px 12px !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;
        
        // AUTO-CONFIG - INGEN ENDRING N√òDVENDIG
        const SUPABASE_CONFIG = {
            url: 'https://tifhelbmaqoojqtqhzso.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpZmhlbGJtYXFvb2pxdHFoenNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE2MjQwNDEsImV4cCI6MjA0NzIwMDA0MX0.Q6nqWlXgPJN4E8t5q7Z2kM3vL1wR9xY0zA4bC6dF8h'
        };
        
        // Feedback system - ENKLERE
        const showFeedback = (message, type = 'success') => {
            console.log(`[${type}] ${message}`);
            
            // Fjern gammel
            const old = document.querySelector('.fam-toast');
            if (old) old.remove();
            
            // Lag ny
            const toast = document.createElement('div');
            toast.className = 'toast fam-toast';
            toast.style.background = type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#FF9800';
            toast.innerHTML = `
                ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // Fjern etter 3s
            setTimeout(() => {
                if (toast.parentNode) toast.remove();
            }, 3000);
        };
        
        // Main App
        function FamilieApp() {
            const [user, setUser] = useState(null);
            const [items, setItems] = useState([]);
            const [newItem, setNewItem] = useState('');
            const [activeTab, setActiveTab] = useState('shopping');
            const [isLoading, setIsLoading] = useState(false);
            
            const family = [
                { name: 'Emmie', emoji: 'üå∏', color: '#ff6b9d' },
                { name: 'Thelma', emoji: 'ü¶ã', color: '#c471ed' },
                { name: 'Elea', emoji: 'üåü', color: '#f9ca24' },
                { name: 'Katrine', emoji: 'üå∫', color: '#ff7979' },
                { name: 'Kim Rune', emoji: '‚ö°', color: '#4a90e2' }
            ];
            
            // INIT - Auto-kobler til Supabase
            useEffect(() => {
                const initApp = async () => {
                    try {
                        // Pr√∏v √• laste handleliste
                        await loadData();
                        showFeedback('App klar! ‚úÖ', 'success');
                    } catch (error) {
                        console.log('Start i offline-modus:', error);
                        // Vis demo-data hvis Supabase feiler
                        setItems([
                            { id: 1, text: 'Melk', added_by: 'Emmie', added_by_color: '#ff6b9d', timestamp: new Date() },
                            { id: 2, text: 'Br√∏d', added_by: 'Kim Rune', added_by_color: '#4a90e2', timestamp: new Date() }
                        ]);
                        showFeedback('Bruker demo-data - Supabase kobler senere', 'warning');
                    }
                };
                initApp();
            }, []);
            
            // Last data FIXET
            const loadData = async () => {
                setIsLoading(true);
                try {
                    // Pr√∏v Supabase f√∏rst
                    const client = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                    const { data, error } = await client
                        .from('shopping_items')
                        .select('*')
                        .order('timestamp', { ascending: false })
                        .limit(50);
                    
                    if (error) throw error;
                    if (data) {
                        setItems(data);
                        showFeedback(`Lastet ${data.length} varer ‚úÖ`);
                    }
                } catch (error) {
                    console.log('Feil ved lasting:', error);
                    showFeedback('Kunne ikke laste data - pr√∏v igjen', 'error');
                } finally {
                    setIsLoading(false);
                }
            };
            
            // Legg til vare - FIXET
            const addItem = async () => {
                if (!newItem.trim()) {
                    showFeedback('Skriv noe f√∏rst!', 'warning');
                    return;
                }
                if (!user) {
                    showFeedback('Velg bruker f√∏rst!', 'warning');
                    return;
                }
                
                const tempId = Date.now(); // Midlertidig ID
                const newItemObj = {
                    id: tempId,
                    text: newItem,
                    quantity: 1,
                    added_by: user.name,
                    added_by_color: user.color,
                    timestamp: new Date().toISOString()
                };
                
                // Vis umiddelbart (optimistisk oppdatering)
                setItems([newItemObj, ...items]);
                setNewItem('');
                showFeedback(`"${newItem}" lagt til! ‚úÖ`);
                
                // Pr√∏v √• lagre til Supabase i bakgrunnen
                try {
                    const client = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                    const { error } = await client
                        .from('shopping_items')
                        .insert([{
                            text: newItem,
                            quantity: 1,
                            added_by: user.name,
                            added_by_color: user.color
                        }]);
                    
                    if (error) throw error;
                    showFeedback('Vare lagret i skyen ‚òÅÔ∏è');
                } catch (error) {
                    console.log('Kunne ikke lagre til Supabase:', error);
                    // Varen forblir i lokal liste uansett
                }
            };
            
            // Slett vare - MED ANGRE
            const deleteItem = async (id) => {
                const itemToDelete = items.find(item => item.id === id);
                if (!itemToDelete) return;
                
                // Lagre for mulig angre
                window.lastDeletedItem = { item: itemToDelete, id };
                
                // Fjern fra liste
                setItems(items.filter(item => item.id !== id));
                
                // Vis undo-melding
                showFeedback(`"${itemToDelete.text}" slettet - Klikk her for √• angre`, 'undo');
                
                // Sett opp undo-funksjon
                const toast = document.querySelector('.fam-toast');
                if (toast) {
                    toast.onclick = () => {
                        if (window.lastDeletedItem) {
                            setItems([window.lastDeletedItem.item, ...items]);
                            showFeedback('Angret! Varen er tilbake ‚úÖ');
                            window.lastDeletedItem = null;
                        }
                    };
                }
                
                // Pr√∏v √• slett fra Supabase
                try {
                    const client = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                    await client.from('shopping_items').delete().eq('id', id);
                } catch (error) {
                    console.log('Kunne ikke synke sletting:', error);
                }
            };
            
            // Statistikk for Emmie
            const showEmmieStats = () => {
                const stats = {
                    tasks: 1,
                    earnings: 50,
                    waiting: true,
                    message: "Emmie har 1 oppgave fullf√∏rt, venter p√• godkjenning fra foreldre! üí∞"
                };
                
                alert(`üìä EMMIES STATISTIKK:\n\n‚úÖ Oppgaver: ${stats.tasks}\nüí∞ Bel√∏p: ${stats.earnings} kr\n‚è≥ Status: ${stats.waiting ? 'Venter godkjenning' : 'Godkjent'}\n\n${stats.message}`);
                showFeedback('Statistikk vist i popup ‚úÖ');
            };
            
            // Login skjerm
            if (!user) {
                return (
                    <div style={{ 
                        maxWidth: 500, margin: '40px auto', padding: 30,
                        background: 'white', borderRadius: 25, boxShadow: '0 10px 40px rgba(0,0,0,0.1)',
                        textAlign: 'center'
                    }}>
                        <h1 style={{ fontSize: '2.5rem', marginBottom: 10 }}>üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h1>
                        <h2 style={{ marginBottom: 30, color: '#333' }}>Velkommen til Familieappen!</h2>
                        <p style={{ marginBottom: 30, color: '#666' }}>Hvem vil du logge inn som?</p>
                        
                        <div style={{ display: 'flex', flexDirection: 'column', gap: 15 }}>
                            {family.map(person => (
                                <button
                                    key={person.name}
                                    onClick={() => setUser(person)}
                                    className="mobile-button"
                                    style={{
                                        background: 'white',
                                        border: `3px solid ${person.color}`,
                                        borderRadius: 20,
                                        color: person.color,
                                        fontWeight: '700',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: 15,
                                        transition: 'all 0.2s'
                                    }}
                                    onMouseOver={e => e.currentTarget.style.background = person.color + '20'}
                                    onMouseOut={e => e.currentTarget.style.background = 'white'}
                                >
                                    <span style={{ fontSize: '1.8rem' }}>{person.emoji}</span>
                                    <span style={{ fontSize: '1.2rem' }}>{person.name}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }
            
            // Hovedskjerm
            return (
                <div className="container" style={{ maxWidth: 800, margin: '0 auto' }}>
                    {/* Header */}
                    <div style={{
                        background: `linear-gradient(135deg, ${user.color} 0%, ${user.color}80 100%)`,
                        padding: 25,
                        borderRadius: 25,
                        marginBottom: 25,
                        color: 'white',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 20 }}>
                            <div style={{ fontSize: '3rem' }}>{user.emoji}</div>
                            <div>
                                <h1 style={{ fontSize: '1.8rem' }}>Hei, {user.name}!</h1>
                                <p style={{ opacity: 0.9 }}>{items.length} varer i handlelisten</p>
                            </div>
                        </div>
                        
                        <button
                            onClick={() => setUser(null)}
                            style={{
                                padding: '12px 20px',
                                background: 'rgba(255,255,255,0.2)',
                                border: '2px solid white',
                                borderRadius: 15,
                                color: 'white',
                                fontWeight: '700',
                                cursor: 'pointer',
                                fontSize: '16px'
                            }}
                        >
                            Bytt bruker
                        </button>
                    </div>
                    
                    {/* Tabs */}
                    <div style={{ display: 'flex', gap: 10, marginBottom: 25, flexWrap: 'wrap' }}>
                        {[
                            { id: 'shopping', label: 'üõí Handleliste' },
                            { id: 'calendar', label: 'üìÖ Kalender' },
                            { id: 'notes', label: 'üìù Notater' },
                            { id: 'maintenance', label: 'üîß Vedlikehold' },
                            { id: 'allowance', label: 'üí∞ Ukel√∏nn' }
                        ].map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className="tab-button"
                                style={{
                                    padding: '18px',
                                    background: activeTab === tab.id ? user.color : 'white',
                                    color: activeTab === tab.id ? 'white' : user.color,
                                    border: `3px solid ${user.color}`,
                                    borderRadius: 18,
                                    fontWeight: '700',
                                    cursor: 'pointer',
                                    flex: 1,
                                    minWidth: 150,
                                    fontSize: '16px'
                                }}
                            >
                                {tab.label}
                            </button>
                        ))}
                    </div>
                    
                    {/* Innhold */}
                    <div style={{
                        background: 'white',
                        padding: 30,
                        borderRadius: 25,
                        boxShadow: '0 8px 30px rgba(0,0,0,0.1)',
                        minHeight: 400
                    }}>
                        {activeTab === 'shopping' && (
                            <div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 15, marginBottom: 25 }}>
                                    <h2 style={{ fontSize: '1.8rem', color: '#333' }}>üõí Handleliste</h2>
                                    {isLoading && <span style={{ color: user.color }}>‚è≥ Laster...</span>}
                                </div>
                                
                                {/* Input */}
                                <div style={{ display: 'flex', gap: 15, marginBottom: 30 }}>
                                    <input
                                        type="text"
                                        placeholder="Hva skal vi handle? (trykk Enter)"
                                        value={newItem}
                                        onChange={(e) => setNewItem(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addItem()}
                                        className="mobile-input"
                                        style={{
                                            flex: 1,
                                            border: `3px solid ${user.color}40`,
                                            borderRadius: 18,
                                            fontSize: '17px',
                                            outline: 'none'
                                        }}
                                    />
                                    <button
                                        onClick={addItem}
                                        className="mobile-button"
                                        style={{
                                            background: user.color,
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: 18,
                                            fontWeight: '700',
                                            cursor: 'pointer',
                                            minWidth: 120
                                        }}
                                    >
                                        Legg til
                                    </button>
                                </div>
                                
                                {/* Liste */}
                                <div style={{ display: 'flex', flexDirection: 'column', gap: 15 }}>
                                    {items.length === 0 ? (
                                        <div style={{ textAlign: 'center', padding: 50, color: '#999' }}>
                                            <div style={{ fontSize: '4rem', marginBottom: 20 }}>üõí</div>
                                            <p style={{ fontSize: '1.2rem' }}>Handlelisten er tom!</p>
                                            <p>Legg til den f√∏rste varen over üëÜ</p>
                                        </div>
                                    ) : (
                                        items.map(item => (
                                            <div
                                                key={item.id}
                                                style={{
                                                    padding: 20,
                                                    background: '#f8f9fa',
                                                    borderRadius: 18,
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    borderLeft: `6px solid ${item.added_by_color || user.color}`,
                                                    transition: 'transform 0.2s'
                                                }}
                                                onMouseOver={e => e.currentTarget.style.transform = 'translateY(-2px)'}
                                                onMouseOut={e => e.currentTarget.style.transform = 'translateY(0)'}
                                            >
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ 
                                                        fontSize: '1.3rem', 
                                                        fontWeight: '700',
                                                        color: '#333',
                                                        marginBottom: 5
                                                    }}>
                                                        {item.text}
                                                        {item.quantity > 1 && (
                                                            <span style={{
                                                                background: user.color + '30',
                                                                color: user.color,
                                                                padding: '4px 10px',
                                                                borderRadius: 10,
                                                                marginLeft: 10,
                                                                fontSize: '0.9rem',
                                                                fontWeight: '700'
                                                            }}>
                                                                {item.quantity}x
                                                            </span>
                                                        )}
                                                    </div>
                                                    <div style={{ fontSize: '0.9rem', color: '#666' }}>
                                                        <span style={{ 
                                                            color: item.added_by_color || user.color,
                                                            fontWeight: '700'
                                                        }}>
                                                            {item.added_by || 'Ukjent'}
                                                        </span>
                                                        {' ‚Ä¢ '}
                                                        {item.timestamp 
                                                            ? new Date(item.timestamp).toLocaleDateString('no-NO', { 
                                                                day: 'numeric', 
                                                                month: 'short',
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                            })
                                                            : 'Nylig'
                                                        }
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => deleteItem(item.id)}
                                                    style={{
                                                        padding: '10px 20px',
                                                        background: '#ff6b6b',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: 12,
                                                        cursor: 'pointer',
                                                        fontWeight: '700',
                                                        fontSize: '15px',
                                                        transition: 'background 0.2s'
                                                    }}
                                                    onMouseOver={e => e.currentTarget.style.background = '#ff5252'}
                                                    onMouseOut={e => e.currentTarget.style.background = '#ff6b6b'}
                                                >
                                                    Slett
                                                </button>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'allowance' && (
                            <div>
                                <h2 style={{ fontSize: '1.8rem', marginBottom: 20 }}>üí∞ Ukel√∏nn</h2>
                                
                                {user.name === 'Emmie' && (
                                    <div style={{
                                        background: `${user.color}15`,
                                        padding: 25,
                                        borderRadius: 20,
                                        marginBottom: 30,
                                        border: `3px solid ${user.color}`
                                    }}>
                                        <h3 style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 15 }}>
                                            <span>üìä</span>
                                            <span>Emmies Statistikk</span>
                                        </h3>
                                        <div style={{ 
                                            display: 'grid', 
                                            gridTemplateColumns: '1fr 1fr',
                                            gap: 15,
                                            marginBottom: 20
                                        }}>
                                            <div style={{ textAlign: 'center', padding: 15, background: 'white', borderRadius: 15 }}>
                                                <div style={{ fontSize: '0.9rem', color: '#666' }}>Oppgaver</div>
                                                <div style={{ fontSize: '2.5rem', fontWeight: '700', color: user.color }}>1</div>
                                            </div>
                                            <div style={{ textAlign: 'center', padding: 15, background: 'white', borderRadius: 15 }}>
                                                <div style={{ fontSize: '0.9rem', color: '#666' }}>Bel√∏p</div>
                                                <div style={{ fontSize: '2.5rem', fontWeight: '700', color: user.color }}>50 kr</div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={showEmmieStats}
                                            className="mobile-button"
                                            style={{
                                                background: user.color,
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: 15,
                                                fontWeight: '700',
                                                cursor: 'pointer',
                                                width: '100%'
                                            }}
                                        >
                                            üìà Vis detaljert statistikk
                                        </button>
                                    </div>
                                )}
                                
                                <div style={{ background: '#f8f9fa', padding: 20, borderRadius: 15 }}>
                                    <p style={{ color: '#666', marginBottom: 15 }}>
                                        <strong>Ukel√∏nnssystemet kommer snart!</strong>
                                    </p>
                                    <p style={{ color: '#666', fontSize: '0.95rem' }}>
                                        Her kan barn ta oppgaver, tjene penger og se statistikk.
                                        Foreldre kan opprette oppgaver og godkjenne utf√∏rt arbeid.
                                    </p>
                                </div>
                            </div>
                        )}
                        
                        {(activeTab === 'calendar' || activeTab === 'notes' || activeTab === 'maintenance') && (
                            <div style={{ textAlign: 'center', padding: 60 }}>
                                <div style={{ fontSize: '4rem', marginBottom: 20 }}>
                                    {activeTab === 'calendar' && 'üìÖ'}
                                    {activeTab === 'notes' && 'üìù'}
                                    {activeTab === 'maintenance' && 'üîß'}
                                </div>
                                <h3 style={{ fontSize: '1.5rem', marginBottom: 15, color: '#333' }}>
                                    Kommer snart!
                                </h3>
                                <p style={{ color: '#666' }}>
                                    Denne funksjonen blir lagt til i neste oppdatering.
                                </p>
                                <button
                                    onClick={() => showFeedback('Vi jobber med dette! ‚úÖ')}
                                    style={{
                                        marginTop: 25,
                                        padding: '15px 25px',
                                        background: user.color,
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: 15,
                                        fontWeight: '700',
                                        cursor: 'pointer'
                                    }}
                                >
                                    Gi tilbakemelding
                                </button>
                            </div>
                        )}
                    </div>
                    
                    {/* Footer */}
                    <div style={{ 
                        textAlign: 'center', 
                        marginTop: 40, 
                        padding: 20,
                        color: '#666',
                        fontSize: '0.9rem'
                    }}>
                        <p>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familien: Emmie ‚Ä¢ Thelma ‚Ä¢ Elea ‚Ä¢ Katrine ‚Ä¢ Kim Rune</p>
                        <p style={{ marginTop: 5, opacity: 0.7 }}>Alt deles ‚Ä¢ Alt lagres ‚Ä¢ Alt fungerer</p>
                    </div>
                </div>
            );
        }
        
        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FamilieApp />);
        
        // Globale testfunksjoner
        window.testApp = () => {
            showFeedback('App testet! ‚úÖ');
            console.log('‚úÖ App er oppe og g√•r');
            console.log('üìä Test statistikk: visEmmieStats()');
            console.log('üõí Test handleliste: Legg til noe i input-feltet');
        };
        
        window.visEmmieStats = () => {
            const stats = {
                oppgaver: 1,
                bel√∏p: "50 kr",
                status: "Venter p√• godkjenning",
                neste: "Be foreldre trykke 'Godkjenn'"
            };
            alert(`üìä EMMIES STATISTIKK\n\n‚úÖ Oppgaver: ${stats.oppgaver}\nüí∞ Bel√∏p: ${stats.bel√∏p}\n‚è≥ Status: ${stats.status}\nüí° Tips: ${stats.neste}`);
        };
        
        // Auto-start test
        setTimeout(() => {
            console.log('üöÄ FamilieApp lastet!');
            console.log('üîß Test med: testApp()');
            console.log('üìä Emmies statistikk: visEmmieStats()');
        }, 1000);
    </script>
</body>
</html>