<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VÃ¥r Familie - Familieapp</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Fredoka:wght@600&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Quicksand', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: 60px repeat(7, 1fr);
      gap: 1px;
      background: #e0e0e0;
      border: 1px solid #e0e0e0;
    }
    .calendar-header {
      background: white;
      padding: 0.75rem;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .calendar-time-slot {
      background: white;
      padding: 0.5rem;
      font-size: 0.75rem;
      color: #666;
      text-align: right;
    }
    .calendar-cell {
      background: white;
      min-height: 60px;
      position: relative;
      padding: 0.25rem;
    }
    .calendar-event {
      position: absolute;
      left: 2px;
      right: 2px;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      overflow: hidden;
      cursor: pointer;
      border-left: 3px solid;
    }
    .month-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #e0e0e0;
      border: 1px solid #e0e0e0;
    }
    .month-day {
      background: white;
      min-height: 100px;
      padding: 0.5rem;
    }
    .month-day-number {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .month-event {
      font-size: 0.7rem;
      padding: 0.15rem 0.3rem;
      margin-bottom: 0.15rem;
      border-radius: 3px;
      border-left: 3px solid;
      cursor: pointer;
    }
    .quantity-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 0.5rem;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 700;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, createElement } = React;
    const { createClient } = supabase;
    
    const SUPABASE_URL = 'https://tifhelbmaqoojqtqhzso.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_qV04eOBVv5jj0VnUOWjBcQ_r-9N-8io';
    
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
    
    const Icon = ({ type, size = 20, ...props }) => {
      const icons = {
        plus: 'M12 5v14m-7-7h14',
        minus: 'M5 12h14',
        check: 'M20 6L9 17l-5-5',
        trash: 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2',
        x: 'M6 18L18 6M6 6l12 12',
        cart: 'M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z',
        calendar: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z',
        note: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z',
        user: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z',
        palette: 'M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01',
        camera: 'M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z',
        left: 'M15 19l-7-7 7-7',
        right: 'M9 5l7 7-7 7',
        wrench: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z',
        chevronUp: 'M5 15l7-7 7 7',
        chevronDown: 'M19 9l-7 7-7-7',
        coins: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
        lock: 'M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z',
        star: 'M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z',
        home: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6',
        tree: 'M12 2L2 12h3v8h5v-6h4v6h5v-8h3L12 2z',
        paw: 'M8 12.5c0-.828.672-1.5 1.5-1.5s1.5.672 1.5 1.5-.672 1.5-1.5 1.5S8 13.328 8 12.5zm7 0c0-.828.672-1.5 1.5-1.5s1.5.672 1.5 1.5-.672 1.5-1.5 1.5-1.5-.672-1.5-1.5zM12 6c-.828 0-1.5.672-1.5 1.5S11.172 9 12 9s1.5-.672 1.5-1.5S12.828 6 12 6zm-3.5 3c-.828 0-1.5.672-1.5 1.5S7.672 12 8.5 12 10 11.328 10 10.5 9.328 9 8.5 9zm7 0c-.828 0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5 1.5-.672 1.5-1.5S16.328 9 15.5 9z',
        book: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',
        sparkles: 'M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z',
        camera: 'M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z M15 13a3 3 0 11-6 0 3 3 0 016 0z',
        trophy: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'
      };
      
      return (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
          <path d={icons[type]} />
        </svg>
      );
    };

    function FamilieApp() {
      const [activeTab, setActiveTab] = useState('shopping');
      const [currentUser, setCurrentUser] = useState(null);
      const [theme, setTheme] = useState('warm');
      const [showThemeSelector, setShowThemeSelector] = useState(false);
      const [showUserSelector, setShowUserSelector] = useState(true);
      
      const [shoppingItems, setShoppingItems] = useState([]);
      const [calendarEvents, setCalendarEvents] = useState([]);
      const [notes, setNotes] = useState([]);
      const [maintenanceTasks, setMaintenanceTasks] = useState([]);
      
      // UkelÃ¸nn state
      const [choreTasks, setChoreTasks] = useState([]);
      const [choreWorkers, setChoreWorkers] = useState([]);
      const [savingsGoals, setSavingsGoals] = useState([]);
      const [payouts, setPayouts] = useState([]);
      const [splitRequests, setSplitRequests] = useState([]);
      const [userProfiles, setUserProfiles] = useState([]);
      const [achievements, setAchievements] = useState([]);
      const [taskComments, setTaskComments] = useState([]);
      const [allowanceAuth, setAllowanceAuth] = useState(null);
      const [showPasswordSetup, setShowPasswordSetup] = useState(false);
      const [showPasswordLogin, setShowPasswordLogin] = useState(false);
      const [passwordInput, setPasswordInput] = useState('');
      const [passwordConfirm, setPasswordConfirm] = useState('');
      const [showTaskProposal, setShowTaskProposal] = useState(false);
      const [showSavingsGoalForm, setShowSavingsGoalForm] = useState(false);
      const [selectedTaskForSplit, setSelectedTaskForSplit] = useState(null);
      const [splitPartner, setSplitPartner] = useState('');
      const [splitMyPercentage, setSplitMyPercentage] = useState(50);
      const [proposedTaskTitle, setProposedTaskTitle] = useState('');
      const [proposedTaskAmount, setProposedTaskAmount] = useState('');
      const [savingsGoalName, setSavingsGoalName] = useState('');
      const [savingsGoalAmount, setSavingsGoalAmount] = useState('');
      const [showStatistics, setShowStatistics] = useState(false);
      const [editingTask, setEditingTask] = useState(null);
      const [editTaskTitle, setEditTaskTitle] = useState('');
      const [editTaskAmount, setEditTaskAmount] = useState('');
      const [viewingChildStats, setViewingChildStats] = useState(null);
      const [showProfileEditor, setShowProfileEditor] = useState(false);
      const [showAchievements, setShowAchievements] = useState(false);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [showDashboard, setShowDashboard] = useState(true);
      
      const [newItemText, setNewItemText] = useState('');
      const [newItemQuantity, setNewItemQuantity] = useState(1);
      const [newEventTitle, setNewEventTitle] = useState('');
      const [newEventDate, setNewEventDate] = useState('');
      const [newEventStartTime, setNewEventStartTime] = useState('');
      const [newEventDuration, setNewEventDuration] = useState('60');
      const [newEventColor, setNewEventColor] = useState('#a8e063');
      const [newEventImage, setNewEventImage] = useState('');
      const [newNoteText, setNewNoteText] = useState('');
      const [newMaintenanceText, setNewMaintenanceText] = useState('');
      
      const [calendarView, setCalendarView] = useState('week');
      const [currentDate, setCurrentDate] = useState(new Date());
      
      const [isLoading, setIsLoading] = useState(true);
    
      const users = [
        { id: 1, name: 'Emmie', emoji: 'ðŸŒ¸', color: '#ff6b9d' },
        { id: 2, name: 'Thelma', emoji: 'ðŸ¦‹', color: '#c471ed' },
        { id: 3, name: 'Elea', emoji: 'ðŸŒŸ', color: '#f9ca24' },
        { id: 4, name: 'Katrine', emoji: 'ðŸŒº', color: '#ff7979' },
        { id: 5, name: 'Kim Rune', emoji: 'âš¡', color: '#4a90e2' }
      ];
    
      const themes = {
        warm: {
          name: 'Varm',
          background: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
          primary: 'linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)',
          primaryColor: '#ff6a88',
          accent: 'linear-gradient(135deg, #4ecdc4 0%, #44a5db 100%)',
          success: 'linear-gradient(135deg, #a8e063 0%, #56ab2f 100%)',
          cardBg: 'white'
        },
        cool: {
          name: 'Kul',
          background: 'linear-gradient(135deg, #e0f7ff 0%, #b3e5fc 100%)',
          primary: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          primaryColor: '#667eea',
          accent: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
          success: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
          cardBg: 'white'
        },
        dark: {
          name: 'MÃ¸rk',
          background: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)',
          primary: 'linear-gradient(135deg, #f857a6 0%, #ff5858 100%)',
          primaryColor: '#f857a6',
          accent: 'linear-gradient(135deg, #7f7fd5 0%, #86a8e7 100%)',
          success: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
          cardBg: '#ecf0f1'
        }
      };
    
      const eventColors = [
        { value: '#a8e063', name: 'GrÃ¸nn' },
        { value: '#4ecdc4', name: 'Turkis' },
        { value: '#f093fb', name: 'Rosa' },
        { value: '#feca57', name: 'Gul' },
        { value: '#ff6b6b', name: 'RÃ¸d' },
        { value: '#667eea', name: 'Lilla' },
        { value: '#ff9ff3', name: 'Lyserosa' },
        { value: '#ff9a56', name: 'Oransje' }
      ];
    
      useEffect(() => {
        loadData();
      }, []);
    
      const loadData = async () => {
        try {
          const { data: shopping } = await supabaseClient
            .from('shopping_items')
            .select('*')
            .order('timestamp', { ascending: false });
          if (shopping) setShoppingItems(shopping);
    
          const { data: events } = await supabaseClient
            .from('calendar_events')
            .select('*')
            .order('date', { ascending: true });
          if (events) setCalendarEvents(events);
    
          const { data: notesList } = await supabaseClient
            .from('notes')
            .select('*')
            .order('timestamp', { ascending: false });
          if (notesList) setNotes(notesList);

          const { data: maintenanceList } = await supabaseClient
            .from('maintenance_tasks')
            .select('*')
            .order('priority', { ascending: true });
          if (maintenanceList) setMaintenanceTasks(maintenanceList);
    
          const { data: themeSetting } = await supabaseClient
            .from('settings')
            .select('value')
            .eq('key', 'theme')
            .single();
          if (themeSetting) setTheme(themeSetting.value);
    
          const savedUser = localStorage.getItem('familieapp_user');
          if (savedUser) {
            setCurrentUser(JSON.parse(savedUser));
            setShowUserSelector(false);
          }
        } catch (error) {
          console.log('Loading data:', error);
        }
        setIsLoading(false);
      };
    
      const selectUser = (user) => {
        setCurrentUser(user);
        setShowUserSelector(false);
        localStorage.setItem('familieapp_user', JSON.stringify(user));
      };
    
      const changeTheme = async (themeName) => {
        setTheme(themeName);
        setShowThemeSelector(false);
        await supabaseClient
          .from('settings')
          .upsert({ key: 'theme', value: themeName }, { onConflict: 'key' });
      };
    
      const addShoppingItem = async () => {
        if (newItemText.trim() && currentUser) {
          const newItem = {
            text: newItemText,
            quantity: newItemQuantity,
            completed: false,
            added_by: currentUser.name,
            added_by_color: currentUser.color,
            timestamp: new Date().toISOString()
          };
          
          const { data } = await supabaseClient
            .from('shopping_items')
            .insert([newItem])
            .select()
            .single();
    
          if (data) {
            setShoppingItems([data, ...shoppingItems]);
            setNewItemText('');
            setNewItemQuantity(1);
          }
        }
      };

      const updateItemQuantity = async (id, currentQuantity, change) => {
        const newQuantity = Math.max(1, currentQuantity + change);
        
        await supabaseClient
          .from('shopping_items')
          .update({ quantity: newQuantity })
          .eq('id', id);

        setShoppingItems(shoppingItems.map(item =>
          item.id === id ? { ...item, quantity: newQuantity } : item
        ));
      };
    
      const toggleShoppingItem = async (id, completed) => {
        await supabaseClient
          .from('shopping_items')
          .update({ completed: !completed })
          .eq('id', id);
    
        setShoppingItems(shoppingItems.map(item =>
          item.id === id ? { ...item, completed: !completed } : item
        ));
      };
    
      const deleteShoppingItem = async (id) => {
        await supabaseClient
          .from('shopping_items')
          .delete()
          .eq('id', id);
    
        setShoppingItems(shoppingItems.filter(item => item.id !== id));
      };
    
      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setNewEventImage(reader.result);
          };
          reader.readAsDataURL(file);
        }
      };
    
      const addCalendarEvent = async () => {
        if (newEventTitle.trim() && newEventDate && newEventStartTime && currentUser) {
          const newEvent = {
            title: newEventTitle,
            date: newEventDate,
            time: newEventStartTime,
            duration: parseInt(newEventDuration),
            color: newEventColor,
            image: newEventImage,
            completed: false,
            added_by: currentUser.name,
            added_by_color: currentUser.color,
            timestamp: new Date().toISOString()
          };
    
          const { data } = await supabaseClient
            .from('calendar_events')
            .insert([newEvent])
            .select()
            .single();
    
          if (data) {
            const updatedEvents = [...calendarEvents, data].sort((a, b) => 
              new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time)
            );
            setCalendarEvents(updatedEvents);
            setNewEventTitle('');
            setNewEventDate('');
            setNewEventStartTime('');
            setNewEventDuration('60');
            setNewEventColor('#a8e063');
            setNewEventImage('');
          }
        }
      };
    
      const toggleCalendarEvent = async (id, completed) => {
        await supabaseClient
          .from('calendar_events')
          .update({ completed: !completed })
          .eq('id', id);
    
        setCalendarEvents(calendarEvents.map(event =>
          event.id === id ? { ...event, completed: !completed } : event
        ));
      };
    
      const deleteCalendarEvent = async (id) => {
        await supabaseClient
          .from('calendar_events')
          .delete()
          .eq('id', id);
    
        setCalendarEvents(calendarEvents.filter(event => event.id !== id));
      };
    
      const addNote = async () => {
        if (newNoteText.trim() && currentUser) {
          const newNote = {
            text: newNoteText,
            added_by: currentUser.name,
            added_by_color: currentUser.color,
            timestamp: new Date().toISOString()
          };
    
          const { data } = await supabaseClient
            .from('notes')
            .insert([newNote])
            .select()
            .single();
    
          if (data) {
            setNotes([data, ...notes]);
            setNewNoteText('');
          }
        }
      };
    
      const deleteNote = async (id) => {
        await supabaseClient
          .from('notes')
          .delete()
          .eq('id', id);
    
        setNotes(notes.filter(note => note.id !== id));
      };

      const addMaintenanceTask = async () => {
        if (newMaintenanceText.trim() && currentUser) {
          const maxPriority = maintenanceTasks.length > 0 
            ? Math.max(...maintenanceTasks.map(t => t.priority))
            : 0;
          
          const newTask = {
            text: newMaintenanceText,
            completed: false,
            priority: maxPriority + 1,
            added_by: currentUser.name,
            added_by_color: currentUser.color,
            timestamp: new Date().toISOString()
          };
    
          const { data } = await supabaseClient
            .from('maintenance_tasks')
            .insert([newTask])
            .select()
            .single();
    
          if (data) {
            setMaintenanceTasks([...maintenanceTasks, data].sort((a, b) => a.priority - b.priority));
            setNewMaintenanceText('');
          }
        }
      };

      const toggleMaintenanceTask = async (id, completed) => {
        await supabaseClient
          .from('maintenance_tasks')
          .update({ completed: !completed })
          .eq('id', id);
    
        setMaintenanceTasks(maintenanceTasks.map(task =>
          task.id === id ? { ...task, completed: !completed } : task
        ));
      };

      const deleteMaintenanceTask = async (id) => {
        await supabaseClient
          .from('maintenance_tasks')
          .delete()
          .eq('id', id);
    
        setMaintenanceTasks(maintenanceTasks.filter(task => task.id !== id));
      };

      const moveMaintenanceTask = async (id, direction) => {
        const currentIndex = maintenanceTasks.findIndex(t => t.id === id);
        if (
          (direction === 'up' && currentIndex === 0) ||
          (direction === 'down' && currentIndex === maintenanceTasks.length - 1)
        ) {
          return;
        }

        const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
        const reorderedTasks = [...maintenanceTasks];
        const [movedTask] = reorderedTasks.splice(currentIndex, 1);
        reorderedTasks.splice(newIndex, 0, movedTask);

        // Update priorities
        const updates = reorderedTasks.map((task, index) => ({
          id: task.id,
          priority: index + 1
        }));

        for (const update of updates) {
          await supabaseClient
            .from('maintenance_tasks')
            .update({ priority: update.priority })
            .eq('id', update.id);
        }

        setMaintenanceTasks(reorderedTasks.map((task, index) => ({
          ...task,
          priority: index + 1
        })));
      };

      // ========== UKELÃ˜NN FUNKSJONER ==========
      
      const hashPassword = async (password) => {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      };

      const checkUserHasPassword = async (userName) => {
        try {
          const { data } = await supabaseClient
            .from('user_passwords')
            .select('*')
            .eq('user_name', userName)
            .single();
          return !!data;
        } catch {
          return false;
        }
      };

      const setUserPassword = async (userName, password) => {
        const passwordHash = await hashPassword(password);
        const { error } = await supabaseClient
          .from('user_passwords')
          .upsert({ user_name: userName, password_hash: passwordHash });
        return !error;
      };

      const verifyPassword = async (userName, password) => {
        try {
          const passwordHash = await hashPassword(password);
          const { data } = await supabaseClient
            .from('user_passwords')
            .select('*')
            .eq('user_name', userName)
            .eq('password_hash', passwordHash)
            .single();
          return !!data;
        } catch {
          return false;
        }
      };

      const handleAllowanceLogin = async () => {
        if (!currentUser) return;
        const hasPassword = await checkUserHasPassword(currentUser.name);
        if (!hasPassword) {
          setShowPasswordSetup(true);
        } else {
          setShowPasswordLogin(true);
        }
      };

      const handlePasswordSetup = async () => {
        if (passwordInput.length < 4) {
          alert('Passordet mÃ¥ vÃ¦re minst 4 tegn');
          return;
        }
        if (passwordInput !== passwordConfirm) {
          alert('Passordene matcher ikke');
          return;
        }
        const success = await setUserPassword(currentUser.name, passwordInput);
        if (success) {
          setAllowanceAuth(currentUser.name);
          setShowPasswordSetup(false);
          setPasswordInput('');
          setPasswordConfirm('');
          loadAllowanceData();
        }
      };

      const handlePasswordLogin = async () => {
        const verified = await verifyPassword(currentUser.name, passwordInput);
        if (verified) {
          setAllowanceAuth(currentUser.name);
          setShowPasswordLogin(false);
          setPasswordInput('');
          loadAllowanceData();
        } else {
          alert('Feil passord');
          setPasswordInput('');
        }
      };

      const loadAllowanceData = async () => {
        try {
          const { data: tasks } = await supabaseClient
            .from('chore_tasks')
            .select('*')
            .order('created_at', { ascending: false });
          if (tasks) setChoreTasks(tasks);

          const { data: workers } = await supabaseClient
            .from('chore_workers')
            .select('*');
          if (workers) setChoreWorkers(workers);

          const { data: payoutData } = await supabaseClient
            .from('payouts')
            .select('*')
            .order('paid_at', { ascending: false });
          if (payoutData) setPayouts(payoutData);
        } catch (error) {
          console.log('Error loading allowance data:', error);
        }
      };

      const createChoreTask = async (title, amount, taskType, category = 'hjemme') => {
        if (!currentUser || (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine')) {
          alert('Kun foreldre kan opprette oppgaver');
          return;
        }
        const now = new Date();
        const newTask = {
          title,
          amount: parseInt(amount),
          task_type: taskType,
          category: category,
          status: 'available',
          created_by: currentUser.name,
          created_by_color: currentUser.color,
          proposed_by_child: false,
          week_number: taskType === 'weekly' ? getWeekNumber(now) : null,
          year: taskType === 'weekly' ? now.getFullYear() : null
        };
        const { data } = await supabaseClient
          .from('chore_tasks')
          .insert([newTask])
          .select()
          .single();
        if (data) {
          setChoreTasks([data, ...choreTasks]);
        }
      };

      const takeChoreTask = async (taskId) => {
        if (currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') {
          alert('Foreldre kan ikke ta oppgaver');
          return;
        }
        const task = choreTasks.find(t => t.id === taskId);
        if (!task || task.status !== 'available') return;
        await supabaseClient
          .from('chore_tasks')
          .update({ status: 'in_progress' })
          .eq('id', taskId);
        const newWorker = {
          task_id: taskId,
          worker_name: currentUser.name,
          worker_color: currentUser.color,
          percentage: 100,
          confirmed: true,
          earned_amount: task.amount
        };
        const { data } = await supabaseClient
          .from('chore_workers')
          .insert([newWorker])
          .select()
          .single();
        if (data) {
          setChoreWorkers([...choreWorkers, data]);
          setChoreTasks(choreTasks.map(t => 
            t.id === taskId ? { ...t, status: 'in_progress' } : t
          ));
        }
      };

      const completeChoreTask = async (taskId) => {
        const worker = choreWorkers.find(w => 
          w.task_id === taskId && 
          w.worker_name === currentUser.name &&
          !w.completed_at
        );
        if (!worker) return;
        await supabaseClient
          .from('chore_workers')
          .update({ completed_at: new Date().toISOString() })
          .eq('id', worker.id);
        await supabaseClient
          .from('chore_tasks')
          .update({ status: 'completed' })
          .eq('id', taskId);
        setChoreWorkers(choreWorkers.map(w=>
          w.id === worker.id ? { ...w, completed_at: new Date().toISOString() } : w
        ));
        setChoreTasks(choreTasks.map(t=>
          t.id === taskId ? { ...t, status: 'completed' } : t
        ));
      };

      const approveChoreTask = async (taskId) => {
        if (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine') {
          alert('Kun foreldre kan godkjenne oppgaver');
          return;
        }
        const worker = choreWorkers.find(w => w.task_id === taskId && w.completed_at && !w.approved_at);
        if (!worker) return;
        await supabaseClient
          .from('chore_workers')
          .update({ 
            approved_at: new Date().toISOString(),
            approved_by: currentUser.name
          })
          .eq('id', worker.id);
        await supabaseClient
          .from('chore_tasks')
          .update({ status: 'approved' })
          .eq('id', taskId);
        setChoreWorkers(choreWorkers.map(w=>
          w.id === worker.id ? { 
            ...w, 
            approved_at: new Date().toISOString(),
            approved_by: currentUser.name 
          } : w
        ));
        setChoreTasks(choreTasks.map(t=>
          t.id === taskId ? { ...t, status: 'approved' } : t
        ));
        
        // Check for achievements
        if (worker) {
          checkAndAwardAchievements(worker.worker_name);
        }
      };

      const rejectChoreTask = async (taskId) => {
        if (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine') {
          alert('Kun foreldre kan avvise oppgaver');
          return;
        }
        await supabaseClient
          .from('chore_workers')
          .delete()
          .eq('task_id', taskId);
        await supabaseClient
          .from('chore_tasks')
          .update({ status: 'available' })
          .eq('id', taskId);
        setChoreWorkers(choreWorkers.filter(w => w.task_id !== taskId));
        setChoreTasks(choreTasks.map(t=>
          t.id === taskId ? { ...t, status: 'available' } : t
        ));
      };

      const calculateBalance = (childName) => {
        const earned = choreWorkers
          .filter(w => w.worker_name === childName && w.approved_at)
          .reduce((sum, w) => sum + (w.earned_amount || 0), 0);
        const paidOut = payouts
          .filter(p => p.child_name === childName)
          .reduce((sum, p) => sum + p.amount, 0);
        return earned - paidOut;
      };

      const payoutBalance = async (childName) => {
        if (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine') {
          alert('Kun foreldre kan utbetale');
          return;
        }
        const balance = calculateBalance(childName);
        if (balance <= 0) {
          alert('Ingen saldo Ã¥ utbetale');
          return;
        }
        const confirmed = window.confirm(`Utbetale ${balance} kr til ${childName}?`);
        if (!confirmed) return;
        const newPayout = {
          child_name: childName,
          amount: balance,
          paid_by: currentUser.name,
          paid_at: new Date().toISOString()
        };
        const { data } = await supabaseClient
          .from('payouts')
          .insert([newPayout])
          .select()
          .single();
        if (data) {
          setPayouts([data, ...payouts]);
        }
      };

      const getWeekNumber = (date) => {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
      };

      // ========== FASE 2: DELING AV OPPGAVER ==========
      
      const requestTaskSplit = async (taskId, partnerName, myPercentage) => {
        const partnerPercentage = 100 - myPercentage;
        
        const newRequest = {
          task_id: taskId,
          requester_name: currentUser.name,
          requester_percentage: myPercentage,
          partner_name: partnerName,
          partner_percentage: partnerPercentage,
          status: 'pending'
        };

        const { data } = await supabaseClient
          .from('chore_split_requests')
          .insert([newRequest])
          .select()
          .single();

        if (data) {
          setSplitRequests([...splitRequests, data]);
          alert(`ForespÃ¸rsel sendt til ${partnerName}!`);
        }
      };

      const acceptSplitRequest = async (requestId) => {
        const request = splitRequests.find(r => r.id === requestId);
        if (!request) return;

        // Oppdater request status
        await supabaseClient
          .from('chore_split_requests')
          .update({ status: 'accepted', responded_at: new Date().toISOString() })
          .eq('id', requestId);

        // Opprett workers for begge
        const task = choreTasks.find(t => t.id === request.task_id);
        
        const workers = [
          {
            task_id: request.task_id,
            worker_name: request.requester_name,
            worker_color: users.find(u => u.name === request.requester_name)?.color || '#666',
            percentage: request.requester_percentage,
            confirmed: true,
            earned_amount: Math.round(task.amount * request.requester_percentage / 100)
          },
          {
            task_id: request.task_id,
            worker_name: request.partner_name,
            worker_color: users.find(u => u.name === request.partner_name)?.color || '#666',
            percentage: request.partner_percentage,
            confirmed: true,
            earned_amount: Math.round(task.amount * request.partner_percentage / 100)
          }
        ];

        const { data } = await supabaseClient
          .from('chore_workers')
          .insert(workers)
          .select();

        if (data) {
          setChoreWorkers([...choreWorkers, ...data]);
          await supabaseClient
            .from('chore_tasks')
            .update({ status: 'in_progress' })
            .eq('id', request.task_id);
          
          setChoreTasks(choreTasks.map(t =>
            t.id === request.task_id ? { ...t, status: 'in_progress' } : t
          ));
        }

        setSplitRequests(splitRequests.map(r =>
          r.id === requestId ? { ...r, status: 'accepted' } : r
        ));
      };

      const rejectSplitRequest = async (requestId) => {
        await supabaseClient
          .from('chore_split_requests')
          .update({ status: 'rejected', responded_at: new Date().toISOString() })
          .eq('id', requestId);

        setSplitRequests(splitRequests.map(r =>
          r.id === requestId ? { ...r, status: 'rejected' } : r
        ));
      };

      // ========== FASE 3: UKENTLIGE OPPGAVER + AUTO-RESET ==========
      
      const checkAndResetWeeklyTasks = async () => {
        const now = new Date();
        const currentWeek = getWeekNumber(now);
        const currentYear = now.getFullYear();
        const dayOfWeek = now.getDay(); // 0 = Sunday

        // KjÃ¸r kun pÃ¥ mandager (1)
        if (dayOfWeek !== 1) return;

        const weeklyTasks = choreTasks.filter(t => 
          t.task_type === 'weekly' && 
          (t.last_reset_week !== currentWeek || t.last_reset_year !== currentYear)
        );

        for (const task of weeklyTasks) {
          // Reset oppgaven
          await supabaseClient
            .from('chore_tasks')
            .update({ 
              status: 'available',
              last_reset_week: currentWeek,
              last_reset_year: currentYear
            })
            .eq('id', task.id);
        }

        // Reload data hvis noe ble resettet
        if (weeklyTasks.length > 0) {
          loadAllowanceData();
        }
      };

      // ========== FASE 4: BARN FORESLÃ…R OPPGAVER ==========
      
      const proposeTask = async () => {
        if (currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') {
          alert('Foreldre trenger ikke foreslÃ¥ oppgaver');
          return;
        }

        if (!proposedTaskTitle || !proposedTaskAmount) {
          alert('Fyll inn tittel og belÃ¸p');
          return;
        }

        const newTask = {
          title: proposedTaskTitle,
          amount: parseInt(proposedTaskAmount),
          task_type: 'once',
          status: 'pending_approval',
          created_by: currentUser.name,
          created_by_color: currentUser.color,
          proposed_by_child: true
        };

        const { data } = await supabaseClient
          .from('chore_tasks')
          .insert([newTask])
          .select()
          .single();

        if (data) {
          setChoreTasks([data, ...choreTasks]);
          setShowTaskProposal(false);
          setProposedTaskTitle('');
          setProposedTaskAmount('');
          alert('Oppgave sendt til foreldre for godkjenning!');
        }
      };

      const approveProposedTask = async (taskId) => {
        await supabaseClient
          .from('chore_tasks')
          .update({ 
            status: 'available',
            approved_by: currentUser.name,
            approved_at: new Date().toISOString()
          })
          .eq('id', taskId);

        setChoreTasks(choreTasks.map(t =>
          t.id === taskId ? { ...t, status: 'available' } : t
        ));
      };

      const rejectProposedTask = async (taskId) => {
        await supabaseClient
          .from('chore_tasks')
          .delete()
          .eq('id', taskId);

        setChoreTasks(choreTasks.filter(t => t.id !== taskId));
      };

      // ========== REDIGERE OG SLETTE OPPGAVER ==========
      
      const deleteTask = async (taskId) => {
        if (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine') {
          alert('Kun foreldre kan slette oppgaver');
          return;
        }

        const confirmed = window.confirm('Er du sikker pÃ¥ at du vil slette denne oppgaven?');
        if (!confirmed) return;

        // Slett workers fÃ¸rst
        await supabaseClient
          .from('chore_workers')
          .delete()
          .eq('task_id', taskId);

        // Slett oppgaven
        await supabaseClient
          .from('chore_tasks')
          .delete()
          .eq('id', taskId);

        setChoreWorkers(choreWorkers.filter(w => w.task_id !== taskId));
        setChoreTasks(choreTasks.filter(t => t.id !== taskId));
      };

      const editTask = async (taskId, newTitle, newAmount) => {
        if (currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine') {
          alert('Kun foreldre kan redigere oppgaver');
          return;
        }

        const parsedAmount = parseInt(newAmount);

        await supabaseClient
          .from('chore_tasks')
          .update({ 
            title: newTitle,
            amount: parsedAmount
          })
          .eq('id', taskId);

        // Oppdater earned_amount for workers som ikke er godkjent ennÃ¥
        const taskWorkers = choreWorkers.filter(w => w.task_id === taskId && !w.approved_at);
        for (const worker of taskWorkers) {
          const newEarnedAmount = Math.round(parsedAmount * worker.percentage / 100);
          await supabaseClient
            .from('chore_workers')
            .update({ earned_amount: newEarnedAmount })
            .eq('id', worker.id);
        }
        
        // Reload all data
        await loadAllowanceDataExtended();
      };

      // ========== PROFILBILDER ==========
      
      const uploadProfilePicture = async (imageData) => {
        await supabaseClient
          .from('user_profiles')
          .upsert({ 
            user_name: currentUser.name,
            profile_image: imageData,
            updated_at: new Date().toISOString()
          });
        
        // Update local state
        const newProfiles = userProfiles.filter(p => p.user_name !== currentUser.name);
        setUserProfiles([...newProfiles, { user_name: currentUser.name, profile_image: imageData }]);
      };

      const handleImageUploadForProfile = (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 5000000) { // 5MB limit
            alert('Bildet er for stort. Maks 5MB.');
            return;
          }
          const reader = new FileReader();
          reader.onloadend = () => {
            uploadProfilePicture(reader.result);
            setShowProfileEditor(false);
          };
          reader.readAsDataURL(file);
        }
      };

      const getUserProfileImage = (userName) => {
        const profile = userProfiles.find(p => p.user_name === userName);
        return profile?.profile_image || null;
      };

      // ========== ACHIEVEMENTS ==========
      
      const achievementDefinitions = {
        first_task: { name: 'FÃ¸rste oppgave!', emoji: 'ðŸŽ¯', description: 'FullfÃ¸rt din fÃ¸rste oppgave' },
        ten_tasks: { name: '10 oppgaver!', emoji: 'â­', description: 'FullfÃ¸rt 10 oppgaver' },
        fifty_tasks: { name: '50 oppgaver!', emoji: 'ðŸ†', description: 'FullfÃ¸rt 50 oppgaver' },
        hundred_tasks: { name: '100 oppgaver!', emoji: 'ðŸ‘‘', description: 'FullfÃ¸rt 100 oppgaver' },
        first_savings_goal: { name: 'SparemÃ¥l nÃ¥dd!', emoji: 'ðŸŽ¯', description: 'NÃ¥dde ditt fÃ¸rste sparemÃ¥l' },
        team_player: { name: 'Lagspiller', emoji: 'ðŸ¤', description: 'Delt 10 oppgaver' },
        week_warrior: { name: 'Ukekriger', emoji: 'ðŸ’ª', description: 'Mest aktiv i uken' },
        month_champion: { name: 'MÃ¥nedens mester', emoji: 'ðŸ¥‡', description: 'Flest oppgaver denne mÃ¥neden' }
      };

      const checkAndAwardAchievements = async (userName) => {
        const userWorkers = choreWorkers.filter(w => w.worker_name === userName && w.approved_at);
        const taskCount = userWorkers.length;
        const userAchievements = achievements.filter(a => a.user_name === userName);
        
        const toAward = [];
        
        // Check task milestones
        if (taskCount >= 1 && !userAchievements.find(a => a.achievement_type === 'first_task')) {
          toAward.push('first_task');
        }
        if (taskCount >= 10 && !userAchievements.find(a => a.achievement_type === 'ten_tasks')) {
          toAward.push('ten_tasks');
        }
        if (taskCount >= 50 && !userAchievements.find(a => a.achievement_type === 'fifty_tasks')) {
          toAward.push('fifty_tasks');
        }
        if (taskCount >= 100 && !userAchievements.find(a => a.achievement_type === 'hundred_tasks')) {
          toAward.push('hundred_tasks');
        }
        
        // Check shared tasks
        const sharedTasks = userWorkers.filter(w => w.percentage < 100).length;
        if (sharedTasks >= 10 && !userAchievements.find(a => a.achievement_type === 'team_player')) {
          toAward.push('team_player');
        }
        
        // Award achievements
        for (const achievementType of toAward) {
          const { data } = await supabaseClient
            .from('user_achievements')
            .insert([{ user_name: userName, achievement_type: achievementType }])
            .select()
            .single();
          
          if (data) {
            setAchievements([...achievements, data]);
            // Show celebration!
            const def = achievementDefinitions[achievementType];
            alert(`ðŸŽ‰ Ny prestasjon! ${def.emoji} ${def.name}\n${def.description}`);
          }
        }
      };

      // ========== SPAREMÃ…L ==========
      
      const createSavingsGoal = async () => {
        if (currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') {
          alert('SparemÃ¥l er for barna');
          return;
        }

        if (!savingsGoalName || !savingsGoalAmount) {
          alert('Fyll inn mÃ¥l og belÃ¸p');
          return;
        }

        const newGoal = {
          child_name: currentUser.name,
          goal_name: savingsGoalName,
          target_amount: parseInt(savingsGoalAmount),
          current_amount: 0
        };

        const { data } = await supabaseClient
          .from('savings_goals')
          .insert([newGoal])
          .select()
          .single();

        if (data) {
          setSavingsGoals([...savingsGoals, data]);
          setShowSavingsGoalForm(false);
          setSavingsGoalName('');
          setSavingsGoalAmount('');
        }
      };

      const updateSavingsGoalProgress = (childName) => {
        const balance = calculateBalance(childName);
        const goals = savingsGoals.filter(g => g.child_name === childName && !g.completed);
        
        goals.forEach(async (goal) => {
          const newAmount = Math.min(balance, goal.target_amount);
          const completed = newAmount >= goal.target_amount;
          
          await supabaseClient
            .from('savings_goals')
            .update({ 
              current_amount: newAmount,
              completed: completed
            })
            .eq('id', goal.id);
        });
      };

      // ========== STATISTIKK ==========
      
      const getChildStats = (childName) => {
        const now = new Date();
        const thisWeek = getWeekNumber(now);
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();
        
        const approvedWorkers = choreWorkers.filter(w => 
          w.worker_name === childName && w.approved_at
        );
        
        const weekEarnings = approvedWorkers
          .filter(w => {
            const date = new Date(w.approved_at);
            return getWeekNumber(date) === thisWeek && date.getFullYear() === thisYear;
          })
          .reduce((sum, w) => sum + (w.earned_amount || 0), 0);
        
        const monthEarnings = approvedWorkers
          .filter(w => {
            const date = new Date(w.approved_at);
            return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
          })
          .reduce((sum, w) => sum + (w.earned_amount || 0), 0);
        
        const yearEarnings = approvedWorkers
          .filter(w => {
            const date = new Date(w.approved_at);
            return date.getFullYear() === thisYear;
          })
          .reduce((sum, w) => sum + (w.earned_amount || 0), 0);

        const totalTasks = approvedWorkers.length;
        
        return { weekEarnings, monthEarnings, yearEarnings, totalTasks };
      };

      // Oppdater loadAllowanceData til Ã¥ inkludere split requests og savings goals
      const loadAllowanceDataExtended = async () => {
        await loadAllowanceData();
        
        try {
          const { data: splits } = await supabaseClient
            .from('chore_split_requests')
            .select('*')
            .order('created_at', { ascending: false });
          if (splits) setSplitRequests(splits);

          const { data: goals } = await supabaseClient
            .from('savings_goals')
            .select('*')
            .order('created_at', { ascending: false });
          if (goals) setSavingsGoals(goals);

          const { data: profiles } = await supabaseClient
            .from('user_profiles')
            .select('*');
          if (profiles) setUserProfiles(profiles);

          const { data: userAchievements } = await supabaseClient
            .from('user_achievements')
            .select('*')
            .order('earned_at', { ascending: false });
          if (userAchievements) setAchievements(userAchievements);

          const { data: comments } = await supabaseClient
            .from('task_comments')
            .select('*')
            .order('created_at', { ascending: false });
          if (comments) setTaskComments(comments);

          // KjÃ¸r weekly reset check
          checkAndResetWeeklyTasks();
        } catch (error) {
          console.log('Error loading extended data:', error);
        }
      };

      useEffect(() => {
        if (activeTab === 'allowance' && allowanceAuth) {
          loadAllowanceDataExtended();
        }
      }, [allowanceAuth]);


      useEffect(() => {
        if (activeTab === 'allowance' && !allowanceAuth && currentUser) {
          handleAllowanceLogin();
        }
      }, [activeTab, currentUser]);


      const getWeekDates = (date) => {
        const start = new Date(date);
        start.setDate(date.getDate() - date.getDay() + 1);
        const dates = [];
        for (let i = 0; i < 7; i++) {
          const d = new Date(start);
          d.setDate(start.getDate() + i);
          dates.push(d);
        }
        return dates;
      };

      const getMonthDays = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const days = [];
        
        const firstDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
          const d = new Date(firstDay);
          d.setDate(firstDay.getDate() - i - 1);
          days.push({ date: d, isCurrentMonth: false });
        }
        
        for (let i = 1; i <= lastDay.getDate(); i++) {
          days.push({ date: new Date(year, month, i), isCurrentMonth: true });
        }
        
        const remaining = 42 - days.length;
        for (let i = 1; i <= remaining; i++) {
          const d = new Date(lastDay);
          d.setDate(lastDay.getDate() + i);
          days.push({ date: d, isCurrentMonth: false });
        }
        
        return days;
      };

      const getEventsForDate = (date) => {
        const dateStr = date.toISOString().split('T')[0];
        return calendarEvents.filter(e => e.date === dateStr);
      };

      const timeToMinutes = (timeStr) => {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
      };

      const getEventPosition = (event) => {
        const startMinutes = timeToMinutes(event.time);
        const top = (startMinutes / 60) * 60;
        const height = (event.duration / 60) * 60;
        return { top, height };
      };
    
      const formatDate = (dateString) => {
        const date = new Date(dateString);
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
    
        if (date.toDateString() === today.toDateString()) return 'I dag';
        if (date.toDateString() === tomorrow.toDateString()) return 'I morgen';
        
        const days = ['SÃ¸ndag', 'Mandag', 'Tirsdag', 'Onsdag', 'Torsdag', 'Fredag', 'LÃ¸rdag'];
        const months = ['jan', 'feb', 'mars', 'apr', 'mai', 'juni', 'juli', 'aug', 'sep', 'okt', 'nov', 'des'];
        return `${days[date.getDay()]} ${date.getDate()}. ${months[date.getMonth()]}`;
      };
    
      const formatTimestamp = (timestamp) => {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
    
        if (diffMins < 1) return 'Akkurat nÃ¥';
        if (diffMins < 60) return `${diffMins} min siden`;
        if (diffHours < 24) return `${diffHours} timer siden`;
        if (diffDays === 1) return 'I gÃ¥r';
        if (diffDays < 7) return `${diffDays} dager siden`;
        
        return date.toLocaleDateString('no-NO', { day: 'numeric', month: 'short' });
      };

      const navigateDate = (direction) => {
        const newDate = new Date(currentDate);
        if (calendarView === 'day') {
          newDate.setDate(newDate.getDate() + direction);
        } else if (calendarView === 'week') {
          newDate.setDate(newDate.getDate() + (direction * 7));
        } else if (calendarView === 'month') {
          newDate.setMonth(newDate.getMonth() + direction);
        }
        setCurrentDate(newDate);
      };

      const goToToday = () => {
        setCurrentDate(new Date());
      };
    
      const currentTheme = themes[theme];
    
      if (isLoading) {
        return (
          <div style={{
            minHeight: '100vh',
            background: currentTheme.background,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            fontFamily: "'Quicksand', sans-serif"
          }}>
            <div style={{ fontSize: '1.5rem', color: '#8b4513' }}>Laster familieapp...</div>
          </div>
        );
      }
    
      if (showUserSelector) {
        return (
          <div style={{
            minHeight: '100vh',
            background: currentTheme.background,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '2rem',
            fontFamily: "'Quicksand', sans-serif"
          }}>
            <div style={{
              background: currentTheme.cardBg,
              padding: '2.5rem',
              borderRadius: '30px',
              boxShadow: '0 10px 40px rgba(0,0,0,0.15)',
              maxWidth: '400px',
              width: '100%'
            }}>
              <h2 style={{
                fontFamily: "'Fredoka', sans-serif",
                fontSize: '2rem',
                textAlign: 'center',
                marginBottom: '1.5rem',
                background: currentTheme.primary,
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                backgroundClip: 'text'
              }}>
                Hvem er du?
              </h2>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                {users.map(user => (
                  <button
                    key={user.id}
                    onClick={() => selectUser(user)}
                    style={{
                      padding: '1.2rem',
                      background: 'white',
                      border: `3px solid ${user.color}`,
                      borderRadius: '20px',
                      fontSize: '1.1rem',
                      fontWeight: '600',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '1rem',
                      transition: 'all 0.3s ease',
                      color: user.color
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.background = user.color;
                      e.currentTarget.style.color = 'white';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.background = 'white';
                      e.currentTarget.style.color = user.color;
                      e.currentTarget.style.transform = 'scale(1)';
                    }}
                  >
                    <span style={{ fontSize: '1.8rem' }}>{user.emoji}</span>
                    <span>{user.name}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      const renderCalendarView = () => {
        if (calendarView === 'day') {
          const events = getEventsForDate(currentDate);
          const hours = Array.from({ length: 16 }, (_, i) => i + 8); // 08:00 to 23:00
          
          return (
            <div style={{ overflowX: 'auto' }}>
              <div className="calendar-grid" style={{ gridTemplateColumns: '60px 1fr' }}>
                <div className="calendar-header" style={{ gridColumn: '1 / 3' }}>
                  {currentDate.toLocaleDateString('no-NO', { weekday: 'long', day: 'numeric', month: 'long' })}
                </div>
                {hours.map(hour => (
                  <React.Fragment key={hour}>
                    <div className="calendar-time-slot">{`${hour.toString().padStart(2, '0')}:00`}</div>
                    <div className="calendar-cell" style={{ position: 'relative' }}>
                      {events.map(event => {
                        const eventStart = timeToMinutes(event.time);
                        const eventHour = Math.floor(eventStart / 60);
                        if (eventHour === hour) {
                          const pos = getEventPosition(event);
                          return (
                            <div
                              key={event.id}
                              className="calendar-event"
                              style={{
                                top: `${(eventStart % 60)}px`,
                                height: `${pos.height}px`,
                                background: event.color + '20',
                                borderLeftColor: event.color,
                                color: '#333'
                              }}
                              onClick={() => toggleCalendarEvent(event.id, event.completed)}
                            >
                              <div style={{ fontWeight: '600', marginBottom: '2px' }}>{event.title}</div>
                              <div style={{ fontSize: '0.7rem', opacity: 0.8 }}>
                                {event.time} â€¢ {event.duration} min â€¢ {event.added_by}
                              </div>
                            </div>
                          );
                        }
                        return null;
                      })}
                    </div>
                  </React.Fragment>
                ))}
              </div>
            </div>
          );
        }

        if (calendarView === 'week') {
          const weekDates = getWeekDates(currentDate);
          const hours = Array.from({ length: 16 }, (_, i) => i + 8); // 08:00 to 23:00
          const dayNames = ['Man', 'Tir', 'Ons', 'Tor', 'Fre', 'LÃ¸r', 'SÃ¸n'];
          
          return (
            <div style={{ overflowX: 'auto' }}>
              <div className="calendar-grid">
                <div className="calendar-header"></div>
                {weekDates.map((date, idx) => (
                  <div key={idx} className="calendar-header">
                    <div>{dayNames[idx]}</div>
                    <div style={{ fontSize: '1.2rem', fontWeight: '700' }}>{date.getDate()}</div>
                  </div>
                ))}
                {hours.map(hour => (
                  <React.Fragment key={hour}>
                    <div className="calendar-time-slot">{`${hour.toString().padStart(2, '0')}:00`}</div>
                    {weekDates.map((date, dayIdx) => {
                      const events = getEventsForDate(date);
                      return (
                        <div key={dayIdx} className="calendar-cell" style={{ position: 'relative' }}>
                          {events.map(event => {
                            const eventStart = timeToMinutes(event.time);
                            const eventHour = Math.floor(eventStart / 60);
                            if (eventHour === hour) {
                              const pos = getEventPosition(event);
                              return (
                                <div
                                  key={event.id}
                                  className="calendar-event"
                                  style={{
                                    top: `${(eventStart % 60)}px`,
                                    height: `${pos.height}px`,
                                    background: event.color + '20',
                                    borderLeftColor: event.color,
                                    color: '#333'
                                  }}
                                  onClick={() => toggleCalendarEvent(event.id, event.completed)}
                                >
                                  <div style={{ fontWeight: '600', fontSize: '0.7rem' }}>{event.title}</div>
                                  <div style={{ fontSize: '0.65rem', opacity: 0.8 }}>
                                    {event.time}
                                  </div>
                                </div>
                              );
                            }
                            return null;
                          })}
                        </div>
                      );
                    })}
                  </React.Fragment>
                ))}
              </div>
            </div>
          );
        }

        if (calendarView === 'month') {
          const monthDays = getMonthDays(currentDate);
          const dayNames = ['Man', 'Tir', 'Ons', 'Tor', 'Fre', 'LÃ¸r', 'SÃ¸n'];
          
          return (
            <div>
              <div className="month-calendar">
                {dayNames.map(day => (
                  <div key={day} className="calendar-header">{day}</div>
                ))}
                {monthDays.map((day, idx) => {
                  const events = getEventsForDate(day.date);
                  return (
                    <div
                      key={idx}
                      className="month-day"
                      style={{
                        opacity: day.isCurrentMonth ? 1 : 0.4,
                        background: day.date.toDateString() === new Date().toDateString() ? '#fff9e6' : 'white'
                      }}
                    >
                      <div className="month-day-number">{day.date.getDate()}</div>
                      {events.slice(0, 3).map(event => (
                        <div
                          key={event.id}
                          className="month-event"
                          style={{
                            background: event.color + '20',
                            borderLeftColor: event.color
                          }}
                          onClick={() => toggleCalendarEvent(event.id, event.completed)}
                        >
                          {event.time} {event.title}
                        </div>
                      ))}
                      {events.length > 3 && (
                        <div style={{ fontSize: '0.7rem', color: '#666', marginTop: '0.15rem' }}>
                          +{events.length - 3} flere
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          );
        }
      };
    
      return (
        <div style={{
          minHeight: '100vh',
          background: currentTheme.background,
          fontFamily: "'Quicksand', sans-serif",
          paddingBottom: '2rem'
        }}>
          <div style={{
            background: currentTheme.primary,
            padding: '2rem 1.5rem',
            boxShadow: `0 4px 20px ${currentTheme.primaryColor}40`,
            borderRadius: '0 0 30px 30px',
            position: 'relative'
          }}>
            <div style={{
              position: 'absolute',
              top: '1rem',
              right: '1rem',
              display: 'flex',
              gap: '0.5rem'
            }}>
              <button
                onClick={() => setShowThemeSelector(!showThemeSelector)}
                style={{
                  padding: '0.6rem',
                  background: 'rgba(255,255,255,0.3)',
                  border: 'none',
                  borderRadius: '12px',
                  color: 'white',
                  cursor: 'pointer',
                  display: 'flex'
                }}
              >
                <Icon type="palette" size={20} />
              </button>
              <button
                onClick={() => setShowUserSelector(true)}
                style={{
                  padding: '0.6rem',
                  background: 'rgba(255,255,255,0.3)',
                  border: 'none',
                  borderRadius: '12px',
                  color: 'white',
                  cursor: 'pointer',
                  display: 'flex'
                }}
              >
                <Icon type="user" size={20} />
              </button>
              {currentUser && (
                <>
                  <button
                    onClick={() => setShowProfileEditor(true)}
                    style={{
                      padding: '0.6rem',
                      background: 'rgba(255,255,255,0.3)',
                      border: 'none',
                      borderRadius: '12px',
                      color: 'white',
                      cursor: 'pointer',
                      display: 'flex'
                    }}
                  >
                    <Icon type="camera" size={20} />
                  </button>
                  <button
                    onClick={() => setShowAchievements(true)}
                    style={{
                      padding: '0.6rem',
                      background: 'rgba(255,255,255,0.3)',
                      border: 'none',
                      borderRadius: '12px',
                      color: 'white',
                      cursor: 'pointer',
                      display: 'flex',
                      position: 'relative'
                    }}
                  >
                    <Icon type="trophy" size={20} />
                    {achievements.filter(a => a.user_name === currentUser.name).length > 0 && (
                      <div style={{
                        position: 'absolute',
                        top: '-4px',
                        right: '-4px',
                        background: '#ff6b6b',
                        color: 'white',
                        borderRadius: '50%',
                        width: '18px',
                        height: '18px',
                        fontSize: '0.7rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontWeight: '700'
                      }}>
                        {achievements.filter(a => a.user_name === currentUser.name).length}
                      </div>
                    )}
                  </button>
                </>
              )}
            </div>

            {showThemeSelector && (
              <div style={{
                position: 'absolute',
                top: '4rem',
                right: '1rem',
                background: 'white',
                padding: '1rem',
                borderRadius: '15px',
                boxShadow: '0 8px 30px rgba(0,0,0,0.2)',
                zIndex: 1000,
                minWidth: '150px'
              }}>
                {Object.entries(themes).map(([key, themeOption]) => (
                  <button
                    key={key}
                    onClick={() => changeTheme(key)}
                    style={{
                      width: '100%',
                      padding: '0.8rem',
                      marginBottom: '0.5rem',
                      background: theme === key ? themeOption.primary : 'white',
                      color: theme === key ? 'white' : '#333',
                      border: theme === key ? 'none' : '2px solid #e0e0e0',
                      borderRadius: '10px',
                      cursor: 'pointer',
                      fontSize: '0.95rem',
                      fontWeight: '600'
                    }}
                  >
                    {themeOption.name}
                  </button>
                ))}
              </div>
            )}

            {/* Profilbilde-editor modal */}
            {showProfileEditor && currentUser && (
              <div className="modal-overlay" onClick={() => setShowProfileEditor(false)}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                    ðŸ“¸ Endre profilbilde
                  </h2>
                  
                  {getUserProfileImage(currentUser.name) && (
                    <div style={{ textAlign: 'center', marginBottom: '1.5rem' }}>
                      <img 
                        src={getUserProfileImage(currentUser.name)} 
                        alt="Current"
                        style={{
                          width: '120px',
                          height: '120px',
                          borderRadius: '50%',
                          objectFit: 'cover',
                          border: `4px solid ${currentUser.color}`
                        }}
                      />
                      <p style={{ marginTop: '0.5rem', color: '#666', fontSize: '0.9rem' }}>NÃ¥vÃ¦rende bilde</p>
                    </div>
                  )}

                  <label
                    style={{
                      display: 'block',
                      padding: '1.5rem',
                      background: currentTheme.cardBg,
                      border: `2px dashed ${currentTheme.primaryColor}`,
                      borderRadius: '15px',
                      textAlign: 'center',
                      cursor: 'pointer',
                      marginBottom: '1rem'
                    }}
                  >
                    <Icon type="camera" size={32} style={{ marginBottom: '0.5rem', color: currentTheme.primaryColor }} />
                    <div style={{ fontWeight: '600', marginBottom: '0.3rem' }}>Last opp bilde</div>
                    <div style={{ fontSize: '0.85rem', color: '#666' }}>
                      Klikk for Ã¥ velge fra galleriet eller ta bilde
                    </div>
                    <input
                      type="file"
                      accept="image/*"
                      capture="environment"
                      onChange={handleImageUploadForProfile}
                      style={{ display: 'none' }}
                    />
                  </label>

                  <button
                    onClick={() => setShowProfileEditor(false)}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      background: '#e0e0e0',
                      border: 'none',
                      borderRadius: '15px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    Lukk
                  </button>
                </div>
              </div>
            )}

            {/* Achievements modal */}
            {showAchievements && currentUser && (
              <div className="modal-overlay" onClick={() => setShowAchievements(false)}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                    ðŸ† Mine prestasjoner
                  </h2>
                  
                  <div style={{ marginBottom: '1.5rem' }}>
                    {achievements.filter(a => a.user_name === currentUser.name).length === 0 ? (
                      <div style={{
                        padding: '2rem',
                        textAlign: 'center',
                        color: '#999'
                      }}>
                        <Icon type="trophy" size={48} style={{ opacity: 0.3, marginBottom: '1rem' }} />
                        <p>Ingen prestasjoner ennÃ¥!</p>
                        <p style={{ fontSize: '0.85rem' }}>FullfÃ¸r oppgaver for Ã¥ lÃ¥se opp badges</p>
                      </div>
                    ) : (
                      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                        {achievements
                          .filter(a => a.user_name === currentUser.name)
                          .map(achievement => {
                            const def = achievementDefinitions[achievement.achievement_type];
                            return (
                              <div
                                key={achievement.id}
                                style={{
                                  padding: '1rem',
                                  background: `${currentUser.color}15`,
                                  border: `2px solid ${currentUser.color}`,
                                  borderRadius: '15px',
                                  textAlign: 'center'
                                }}
                              >
                                <div style={{ fontSize: '2.5rem', marginBottom: '0.5rem' }}>
                                  {def?.emoji || 'ðŸ†'}
                                </div>
                                <div style={{ fontWeight: '700', fontSize: '0.9rem', marginBottom: '0.3rem' }}>
                                  {def?.name || achievement.achievement_type}
                                </div>
                                <div style={{ fontSize: '0.75rem', color: '#666' }}>
                                  {def?.description || ''}
                                </div>
                                <div style={{ fontSize: '0.7rem', color: '#999', marginTop: '0.5rem' }}>
                                  {new Date(achievement.earned_at).toLocaleDateString('no-NO')}
                                </div>
                              </div>
                            );
                          })}
                      </div>
                    )}
                  </div>

                  <div style={{ 
                    padding: '1rem', 
                    background: '#f5f5f5', 
                    borderRadius: '10px',
                    marginBottom: '1rem'
                  }}>
                    <div style={{ fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem' }}>
                      Tilgjengelige prestasjoner:
                    </div>
                    <div style={{ fontSize: '0.8rem', color: '#666', lineHeight: '1.6' }}>
                      ðŸŽ¯ FÃ¸rste oppgave â€¢ â­ 10 oppgaver â€¢ ðŸ† 50 oppgaver â€¢ ðŸ‘‘ 100 oppgaver<br />
                      ðŸŽ¯ SparemÃ¥l nÃ¥dd â€¢ ðŸ¤ Lagspiller (10 delte) â€¢ ðŸ’ª Ukekriger â€¢ ðŸ¥‡ MÃ¥nedens mester
                    </div>
                  </div>

                  <button
                    onClick={() => setShowAchievements(false)}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      background: currentTheme.success,
                      border: 'none',
                      borderRadius: '15px',
                      color: 'white',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    Lukk
                  </button>
                </div>
              </div>
            )}

            <h1 style={{
              margin: '0',
              fontSize: '2.2rem',
              fontFamily: "'Fredoka', sans-serif",
              color: 'white',
              textAlign: 'center',
              textShadow: '2px 2px 4px rgba(0,0,0,0.1)'
            }}>
              ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ VÃ¥r familie
            </h1>
            {currentUser && (
              <p style={{
                margin: '0.5rem 0 0 0',
                textAlign: 'center',
                color: 'rgba(255,255,255,0.95)',
                fontSize: '0.95rem',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: '0.5rem'
              }}>
                {getUserProfileImage(currentUser.name) ? (
                  <img 
                    src={getUserProfileImage(currentUser.name)} 
                    alt={currentUser.name}
                    style={{
                      width: '32px',
                      height: '32px',
                      borderRadius: '50%',
                      objectFit: 'cover',
                      border: '2px solid white'
                    }}
                  />
                ) : (
                  <span style={{ fontSize: '1.5rem' }}>{currentUser.emoji}</span>
                )}
                <strong>{currentUser.name}</strong>
              </p>
            )}
          </div>

          <div style={{
            display: 'flex',
            gap: '0.7rem',
            padding: '1.5rem 1rem',
            justifyContent: 'center',
            flexWrap: 'wrap'
          }}>
            {[
              { id: 'shopping', icon: 'cart', label: 'Handleliste' },
              { id: 'calendar', icon: 'calendar', label: 'Kalender' },
              { id: 'notes', icon: 'note', label: 'Notater' },
              { id: 'maintenance', icon: 'wrench', label: 'Vedlikehold' },
              { id: 'allowance', icon: 'coins', label: 'UkelÃ¸nn' }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                style={{
                  flex: '1',
                  minWidth: '140px',
                  maxWidth: '180px',
                  padding: '1rem',
                  background: activeTab === tab.id ? currentTheme.primary : currentTheme.cardBg,
                  color: activeTab === tab.id ? 'white' : currentTheme.primaryColor,
                  border: activeTab === tab.id ? 'none' : `2px solid ${currentTheme.primaryColor}`,
                  borderRadius: '20px',
                  fontSize: '0.95rem',
                  fontWeight: '600',
                  cursor: 'pointer',
                  boxShadow: activeTab === tab.id 
                    ? `0 6px 20px ${currentTheme.primaryColor}40`
                    : '0 2px 10px rgba(0,0,0,0.1)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '0.5rem',
                  transition: 'all 0.3s ease',
                  transform: activeTab === tab.id ? 'translateY(-2px)' : 'translateY(0)'
                }}
              >
                <Icon type={tab.icon} size={18} />
                {tab.label}
              </button>
            ))}
          </div>

          <div style={{ padding: '0 1.5rem 2rem' }}>
            {activeTab === 'shopping' && (
              <div>
                <a
                  href="https://etilbudsavis.no/"
                  target="_blank"
                  rel="noopener noreferrer"
                  style={{
                    display: 'block',
                    background: 'linear-gradient(135deg, #feca57 0%, #ff9a56 100%)',
                    padding: '1rem',
                    borderRadius: '20px',
                    boxShadow: '0 4px 15px rgba(254, 202, 87, 0.3)',
                    marginBottom: '1.5rem',
                    textDecoration: 'none',
                    color: 'white',
                    fontWeight: '600',
                    fontSize: '1.05rem',
                    textAlign: 'center',
                    transition: 'transform 0.2s ease'
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.transform = 'scale(1.02)'}
                  onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}
                >
                  ðŸ·ï¸ Se ukens tilbud pÃ¥ eTilbudsavis
                </a>
                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1.5rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                  marginBottom: '1.5rem'
                }}>
                  <input
                    type="text"
                    placeholder="Hva skal vi handle?"
                    value={newItemText}
                    onChange={(e) => setNewItemText(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addShoppingItem()}
                    style={{
                      width: '100%',
                      padding: '0.9rem',
                      border: '2px solid #ffd4c4',
                      borderRadius: '15px',
                      fontSize: '1rem',
                      outline: 'none',
                      marginBottom: '0.75rem',
                      boxSizing: 'border-box'
                    }}
                  />
                  <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'center' }}>
                    <label style={{ fontSize: '0.9rem', fontWeight: '600', color: '#666' }}>
                      Antall:
                    </label>
                    <input
                      type="number"
                      min="1"
                      value={newItemQuantity}
                      onChange={(e) => setNewItemQuantity(parseInt(e.target.value) || 1)}
                      style={{
                        width: '80px',
                        padding: '0.9rem',
                        border: '2px solid #ffd4c4',
                        borderRadius: '15px',
                        fontSize: '1rem',
                        outline: 'none'
                      }}
                    />
                    <button
                      onClick={addShoppingItem}
                      style={{
                        flex: '1',
                        padding: '0.9rem',
                        background: currentTheme.accent,
                        border: 'none',
                        borderRadius: '15px',
                        color: 'white',
                        cursor: 'pointer',
                        boxShadow: '0 4px 12px rgba(78, 205, 196, 0.3)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '0.5rem',
                        fontWeight: '600',
                        fontSize: '1rem'
                      }}
                    >
                      <Icon type="plus" size={20} />
                      Legg til
                    </button>
                  </div>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                  {shoppingItems.length === 0 ? (
                    <div style={{
                      background: currentTheme.cardBg,
                      padding: '3rem 2rem',
                      borderRadius: '20px',
                      textAlign: 'center',
                      color: '#999'
                    }}>
                      <Icon type="cart" size={48} style={{ margin: '0 auto 1rem', opacity: 0.3 }} />
                      <p>Handlelisten er tom!</p>
                    </div>
                  ) : (
                    shoppingItems.map(item => (
                      <div
                        key={item.id}
                        style={{
                          background: currentTheme.cardBg,
                          padding: '1.2rem',
                          borderRadius: '15px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '1rem',
                          opacity: item.completed ? 0.6 : 1
                        }}
                      >
                        <button
                          onClick={() => toggleShoppingItem(item.id, item.completed)}
                          style={{
                            width: '32px',
                            height: '32px',
                            borderRadius: '50%',
                            border: item.completed ? 'none' : `3px solid ${item.added_by_color}`,
                            background: item.completed ? item.added_by_color : 'white',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            flexShrink: 0
                          }}
                        >
                          {item.completed && <Icon type="check" size={18} color="white" />}
                        </button>
                        <div style={{ flex: '1' }}>
                          <div style={{
                            fontSize: '1.05rem',
                            textDecoration: item.completed ? 'line-through' : 'none',
                            color: item.completed ? '#999' : '#333',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            marginBottom: '0.2rem'
                          }}>
                            <span>{item.text}</span>
                            <span 
                              className="quantity-badge"
                              style={{
                                background: item.added_by_color + '20',
                                color: item.added_by_color,
                                border: `2px solid ${item.added_by_color}`
                              }}
                            >
                              {item.quantity}x
                            </span>
                          </div>
                          <div style={{
                            fontSize: '0.8rem',
                            color: item.added_by_color,
                            fontWeight: '600'
                          }}>
                            {item.added_by} â€¢ {formatTimestamp(item.timestamp)}
                          </div>
                        </div>
                        <div style={{ display: 'flex', gap: '0.25rem', alignItems: 'center' }}>
                          <button
                            onClick={() => updateItemQuantity(item.id, item.quantity, -1)}
                            style={{
                              width: '32px',
                              height: '32px',
                              borderRadius: '50%',
                              background: '#f0f0f0',
                              border: 'none',
                              cursor: 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: '#666'
                            }}
                          >
                            <Icon type="minus" size={16} />
                          </button>
                          <button
                            onClick={() => updateItemQuantity(item.id, item.quantity, 1)}
                            style={{
                              width: '32px',
                              height: '32px',
                              borderRadius: '50%',
                              background: '#f0f0f0',
                              border: 'none',
                              cursor: 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: '#666'
                            }}
                          >
                            <Icon type="plus" size={16} />
                          </button>
                        </div>
                        <button
                          onClick={() => deleteShoppingItem(item.id)}
                          style={{
                            padding: '0.5rem',
                            background: 'none',
                            border: 'none',
                            color: '#ff6b6b',
                            cursor: 'pointer',
                            borderRadius: '10px'
                          }}
                        >
                          <Icon type="trash" size={20} />
                        </button>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {activeTab === 'calendar' && (
              <div>
                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1.5rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                  marginBottom: '1.5rem'
                }}>
                  <input
                    type="text"
                    placeholder="Hva skal vi gjÃ¸re?"
                    value={newEventTitle}
                    onChange={(e) => setNewEventTitle(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '0.9rem',
                      border: '2px solid #ffd4c4',
                      borderRadius: '15px',
                      fontSize: '1rem',
                      marginBottom: '0.75rem',
                      outline: 'none',
                      boxSizing: 'border-box'
                    }}
                  />
                  <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '0.75rem' }}>
                    <input
                      type="date"
                      value={newEventDate}
                      onChange={(e) => setNewEventDate(e.target.value)}
                      style={{
                        flex: '1',
                        padding: '0.9rem',
                        border: '2px solid #ffd4c4',
                        borderRadius: '15px',
                        fontSize: '1rem',
                        outline: 'none'
                      }}
                    />
                    <input
                      type="time"
                      value={newEventStartTime}
                      onChange={(e) => setNewEventStartTime(e.target.value)}
                      style={{
                        flex: '1',
                        padding: '0.9rem',
                        border: '2px solid #ffd4c4',
                        borderRadius: '15px',
                        fontSize: '1rem',
                        outline: 'none'
                      }}
                    />
                  </div>
                  
                  <div style={{ marginBottom: '0.75rem' }}>
                    <label style={{ fontSize: '0.85rem', color: '#666', fontWeight: '600', display: 'block', marginBottom: '0.5rem' }}>
                      Varighet (minutter):
                    </label>
                    <select
                      value={newEventDuration}
                      onChange={(e) => setNewEventDuration(e.target.value)}
                      style={{
                        width: '100%',
                        padding: '0.9rem',
                        border: '2px solid #ffd4c4',
                        borderRadius: '15px',
                        fontSize: '1rem',
                        outline: 'none',
                        background: 'white'
                      }}
                    >
                      <option value="15">15 minutter</option>
                      <option value="30">30 minutter</option>
                      <option value="45">45 minutter</option>
                      <option value="60">1 time</option>
                      <option value="90">1.5 timer</option>
                      <option value="120">2 timer</option>
                      <option value="180">3 timer</option>
                      <option value="240">4 timer</option>
                    </select>
                  </div>

                  <div style={{ marginBottom: '0.75rem' }}>
                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.5rem', fontWeight: '600' }}>
                      Velg farge:
                    </div>
                    <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                      {eventColors.map(color => (
                        <button
                          key={color.value}
                          onClick={() => setNewEventColor(color.value)}
                          style={{
                            width: '36px',
                            height: '36px',
                            borderRadius: '50%',
                            background: color.value,
                            border: newEventColor === color.value ? '3px solid #333' : '2px solid #ddd',
                            cursor: 'pointer',
                            transform: newEventColor === color.value ? 'scale(1.1)' : 'scale(1)'
                          }}
                          title={color.name}
                        />
                      ))}
                    </div>
                  </div>

                  <div style={{ marginBottom: '0.75rem' }}>
                    <label style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '0.5rem',
                      padding: '0.9rem',
                      border: '2px dashed #ffd4c4',
                      borderRadius: '15px',
                      cursor: 'pointer',
                      fontSize: '0.95rem',
                      color: '#666'
                    }}>
                      <Icon type="camera" size={20} />
                      {newEventImage ? 'Bilde lastet opp âœ“' : 'Last opp bilde (valgfritt)'}
                      <input
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        style={{ display: 'none' }}
                      />
                    </label>
                    {newEventImage && (
                      <div style={{ marginTop: '0.5rem', position: 'relative' }}>
                        <img src={newEventImage} alt="Preview" style={{ width: '100%', maxHeight: '150px', objectFit: 'cover', borderRadius: '10px' }} />
                        <button
                          onClick={() => setNewEventImage('')}
                          style={{
                            position: 'absolute',
                            top: '0.5rem',
                            right: '0.5rem',
                            background: 'rgba(255,107,107,0.9)',
                            border: 'none',
                            borderRadius: '50%',
                            width: '30px',
                            height: '30px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            cursor: 'pointer',
                            color: 'white'
                          }}
                        >
                          <Icon type="x" size={18} />
                        </button>
                      </div>
                    )}
                  </div>

                  <button
                    onClick={addCalendarEvent}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      background: currentTheme.success,
                      border: 'none',
                      borderRadius: '15px',
                      color: 'white',
                      fontSize: '1rem',
                      fontWeight: '600',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '0.5rem'
                    }}
                  >
                    <Icon type="plus" size={20} />
                    Legg til aktivitet
                  </button>
                </div>

                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                  marginBottom: '1.5rem',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  flexWrap: 'wrap',
                  gap: '1rem'
                }}>
                  <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                    <button
                      onClick={() => navigateDate(-1)}
                      style={{
                        padding: '0.5rem',
                        background: currentTheme.primaryColor,
                        border: 'none',
                        borderRadius: '10px',
                        color: 'white',
                        cursor: 'pointer',
                        display: 'flex'
                      }}
                    >
                      <Icon type="left" size={20} />
                    </button>
                    <button
                      onClick={goToToday}
                      style={{
                        padding: '0.5rem 1rem',
                        background: 'white',
                        border: `2px solid ${currentTheme.primaryColor}`,
                        borderRadius: '10px',
                        color: currentTheme.primaryColor,
                        cursor: 'pointer',
                        fontWeight: '600'
                      }}
                    >
                      I dag
                    </button>
                    <button
                      onClick={() => navigateDate(1)}
                      style={{
                        padding: '0.5rem',
                        background: currentTheme.primaryColor,
                        border: 'none',
                        borderRadius: '10px',
                        color: 'white',
                        cursor: 'pointer',
                        display: 'flex'
                      }}
                    >
                      <Icon type="right" size={20} />
                    </button>
                  </div>

                  <div style={{ fontSize: '1.1rem', fontWeight: '600' }}>
                    {calendarView === 'day' && currentDate.toLocaleDateString('no-NO', { day: 'numeric', month: 'long', year: 'numeric' })}
                    {calendarView === 'week' && `Uke ${Math.ceil((currentDate.getDate() + new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay()) / 7)}`}
                    {calendarView === 'month' && currentDate.toLocaleDateString('no-NO', { month: 'long', year: 'numeric' })}
                  </div>

                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    {['day', 'week', 'month'].map(view => (
                      <button
                        key={view}
                        onClick={() => setCalendarView(view)}
                        style={{
                          padding: '0.5rem 1rem',
                          background: calendarView === view ? currentTheme.primaryColor : 'white',
                          color: calendarView === view ? 'white' : currentTheme.primaryColor,
                          border: `2px solid ${currentTheme.primaryColor}`,
                          borderRadius: '10px',
                          cursor: 'pointer',
                          fontWeight: '600',
                          fontSize: '0.9rem'
                        }}
                      >
                        {view === 'day' ? 'Dag' : view === 'week' ? 'Uke' : 'MÃ¥ned'}
                      </button>
                    ))}
                  </div>
                </div>

                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)'
                }}>
                  {renderCalendarView()}
                </div>
              </div>
            )}

            {activeTab === 'notes' && (
              <div>
                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1.5rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                  marginBottom: '1.5rem'
                }}>
                  <textarea
                    placeholder="Skriv et notat eller huskeliste..."
                    value={newNoteText}
                    onChange={(e) => setNewNoteText(e.target.value)}
                    style={{
                      width: '100%',
                      minHeight: '100px',
                      padding: '0.9rem',
                      border: '2px solid #ffd4c4',
                      borderRadius: '15px',
                      fontSize: '1rem',
                      marginBottom: '0.75rem',
                      outline: 'none',
                      boxSizing: 'border-box',
                      fontFamily: "'Quicksand', sans-serif",
                      resize: 'vertical'
                    }}
                  />
                  <button
                    onClick={addNote}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      background: currentTheme.accent,
                      border: 'none',
                      borderRadius: '15px',
                      color: 'white',
                      fontSize: '1rem',
                      fontWeight: '600',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '0.5rem'
                    }}
                  >
                    <Icon type="plus" size={20} />
                    Legg til notat
                  </button>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                  {notes.length === 0 ? (
                    <div style={{
                      background: currentTheme.cardBg,
                      padding: '3rem 2rem',
                      borderRadius: '20px',
                      textAlign: 'center',
                      color: '#999'
                    }}>
                      <Icon type="note" size={48} style={{ margin: '0 auto 1rem', opacity: 0.3 }} />
                      <p>Ingen notater ennÃ¥!</p>
                    </div>
                  ) : (
                    notes.map(note => (
                      <div
                        key={note.id}
                        style={{
                          background: currentTheme.cardBg,
                          padding: '1.2rem',
                          borderRadius: '15px',
                          borderLeft: `4px solid ${note.added_by_color}`,
                          position: 'relative'
                        }}
                      >
                        <button
                          onClick={() => deleteNote(note.id)}
                          style={{
                            position: 'absolute',
                            top: '1rem',
                            right: '1rem',
                            padding: '0.5rem',
                            background: 'none',
                            border: 'none',
                            color: '#ff6b6b',
                            cursor: 'pointer',
                            borderRadius: '10px'
                          }}
                        >
                          <Icon type="trash" size={20} />
                        </button>
                        <div style={{
                          fontSize: '1.05rem',
                          marginBottom: '0.8rem',
                          paddingRight: '2rem',
                          whiteSpace: 'pre-wrap'
                        }}>
                          {note.text}
                        </div>
                        <div style={{
                          fontSize: '0.8rem',
                          color: note.added_by_color,
                          fontWeight: '600'
                        }}>
                          {note.added_by} â€¢ {formatTimestamp(note.timestamp)}
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {activeTab === 'maintenance' && (
              <div>
                <div style={{
                  background: currentTheme.cardBg,
                  padding: '1.5rem',
                  borderRadius: '20px',
                  boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                  marginBottom: '1.5rem'
                }}>
                  <input
                    type="text"
                    placeholder="Hva mÃ¥ vedlikeholdes?"
                    value={newMaintenanceText}
                    onChange={(e) => setNewMaintenanceText(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addMaintenanceTask()}
                    style={{
                      width: '100%',
                      padding: '0.9rem',
                      border: '2px solid #ffd4c4',
                      borderRadius: '15px',
                      fontSize: '1rem',
                      marginBottom: '0.75rem',
                      outline: 'none',
                      boxSizing: 'border-box'
                    }}
                  />
                  <button
                    onClick={addMaintenanceTask}
                    style={{
                      width: '100%',
                      padding: '1rem',
                      background: currentTheme.accent,
                      border: 'none',
                      borderRadius: '15px',
                      color: 'white',
                      fontSize: '1rem',
                      fontWeight: '600',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '0.5rem'
                    }}
                  >
                    <Icon type="plus" size={20} />
                    Legg til oppgave
                  </button>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                  {maintenanceTasks.length === 0 ? (
                    <div style={{
                      background: currentTheme.cardBg,
                      padding: '3rem 2rem',
                      borderRadius: '20px',
                      textAlign: 'center',
                      color: '#999'
                    }}>
                      <Icon type="wrench" size={48} style={{ margin: '0 auto 1rem', opacity: 0.3 }} />
                      <p>Ingen vedlikeholdsoppgaver ennÃ¥!</p>
                    </div>
                  ) : (
                    maintenanceTasks.map((task, index) => (
                      <div
                        key={task.id}
                        style={{
                          background: currentTheme.cardBg,
                          padding: '1.2rem',
                          borderRadius: '15px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '1rem',
                          opacity: task.completed ? 0.6 : 1,
                          borderLeft: `4px solid ${task.added_by_color}`
                        }}
                      >
                        <button
                          onClick={() => toggleMaintenanceTask(task.id, task.completed)}
                          style={{
                            width: '32px',
                            height: '32px',
                            borderRadius: '50%',
                            border: task.completed ? 'none' : `3px solid ${task.added_by_color}`,
                            background: task.completed ? task.added_by_color : 'white',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            flexShrink: 0
                          }}
                        >
                          {task.completed && <Icon type="check" size={18} color="white" />}
                        </button>
                        <div style={{ flex: '1' }}>
                          <div style={{
                            fontSize: '1.05rem',
                            textDecoration: task.completed ? 'line-through' : 'none',
                            color: task.completed ? '#999' : '#333',
                            marginBottom: '0.2rem'
                          }}>
                            {task.text}
                          </div>
                          <div style={{
                            fontSize: '0.8rem',
                            color: task.added_by_color,
                            fontWeight: '600'
                          }}>
                            {task.added_by} â€¢ {formatTimestamp(task.timestamp)}
                          </div>
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.25rem' }}>
                          <button
                            onClick={() => moveMaintenanceTask(task.id, 'up')}
                            disabled={index === 0}
                            style={{
                              width: '32px',
                              height: '32px',
                              borderRadius: '8px',
                              background: index === 0 ? '#f0f0f0' : currentTheme.primaryColor,
                              border: 'none',
                              cursor: index === 0 ? 'not-allowed' : 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: 'white',
                              opacity: index === 0 ? 0.3 : 1
                            }}
                          >
                            <Icon type="chevronUp" size={16} />
                          </button>
                          <button
                            onClick={() => moveMaintenanceTask(task.id, 'down')}
                            disabled={index === maintenanceTasks.length - 1}
                            style={{
                              width: '32px',
                              height: '32px',
                              borderRadius: '8px',
                              background: index === maintenanceTasks.length - 1 ? '#f0f0f0' : currentTheme.primaryColor,
                              border: 'none',
                              cursor: index === maintenanceTasks.length - 1 ? 'not-allowed' : 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: 'white',
                              opacity: index === maintenanceTasks.length - 1 ? 0.3 : 1
                            }}
                          >
                            <Icon type="chevronDown" size={16} />
                          </button>
                        </div>
                        <button
                          onClick={() => deleteMaintenanceTask(task.id)}
                          style={{
                            padding: '0.5rem',
                            background: 'none',
                            border: 'none',
                            color: '#ff6b6b',
                            cursor: 'pointer',
                            borderRadius: '10px'
                          }}
                        >
                          <Icon type="trash" size={20} />
                        </button>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {activeTab === 'allowance' && (
              <div>
                {!allowanceAuth ? (
                  <div>
                    {showPasswordSetup && (
                      <div className="modal-overlay" onClick={() => setShowPasswordSetup(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1.5rem', color: currentTheme.primaryColor }}>
                            Opprett passord
                          </h2>
                          <p style={{ marginBottom: '1rem', color: '#666' }}>
                            Velkommen {currentUser.emoji} {currentUser.name}! Opprett et passord for Ã¥ bruke UkelÃ¸nn-funksjonen.
                          </p>
                          <input
                            type="password"
                            placeholder="Passord (minst 4 tegn)"
                            value={passwordInput}
                            onChange={(e) => setPasswordInput(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '0.75rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          <input
                            type="password"
                            placeholder="Bekreft passord"
                            value={passwordConfirm}
                            onChange={(e) => setPasswordConfirm(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handlePasswordSetup()}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => setShowPasswordSetup(false)}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={handlePasswordSetup}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Opprett
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {showPasswordLogin && (
                      <div className="modal-overlay" onClick={() => setShowPasswordLogin(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1.5rem', color: currentTheme.primaryColor }}>
                            <Icon type="lock" size={32} style={{ marginBottom: '0.5rem' }} />
                            <br />
                            Logg inn
                          </h2>
                          <p style={{ marginBottom: '1rem', color: '#666' }}>
                            Hei {currentUser.emoji} {currentUser.name}! Skriv inn passordet ditt.
                          </p>
                          <input
                            type="password"
                            placeholder="Passord"
                            value={passwordInput}
                            onChange={(e) => setPasswordInput(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handlePasswordLogin()}
                            autoFocus
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => setShowPasswordLogin(false)}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={handlePasswordLogin}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Logg inn
                            </button>
                          </div>
                        </div>
                      </div>
                    )}
                    
                    {/* FASE 2: Del oppgave modal */}
                    {selectedTaskForSplit && (
                      <div className="modal-overlay" onClick={() => setSelectedTaskForSplit(null)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                            ðŸ‘¥ Del oppgave
                          </h2>
                          <p style={{ marginBottom: '0.5rem', fontWeight: '600' }}>{selectedTaskForSplit.title}</p>
                          <p style={{ marginBottom: '1rem', color: '#666' }}>Totalt: {selectedTaskForSplit.amount} kr</p>
                          
                          <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                            Hvem vil du dele med?
                          </label>
                          <select
                            value={splitPartner}
                            onChange={(e) => setSplitPartner(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              background: 'white',
                              boxSizing: 'border-box'
                            }}
                          >
                            <option value="">Velg...</option>
                            {['Emmie', 'Thelma', 'Elea'].filter(n => n !== currentUser.name).map(name => (
                              <option key={name} value={name}>{name}</option>
                            ))}
                          </select>

                          <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600' }}>
                            Din andel: {splitMyPercentage}% ({Math.round(selectedTaskForSplit.amount * splitMyPercentage / 100)} kr)
                          </label>
                          <input
                            type="range"
                            min="10"
                            max="90"
                            value={splitMyPercentage}
                            onChange={(e) => setSplitMyPercentage(parseInt(e.target.value))}
                            style={{
                              width: '100%',
                              marginBottom: '0.5rem'
                            }}
                          />
                          <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                            {splitPartner || 'Partner'}: {100 - splitMyPercentage}% ({Math.round(selectedTaskForSplit.amount * (100 - splitMyPercentage) / 100)} kr)
                          </p>

                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => {
                                setSelectedTaskForSplit(null);
                                setSplitPartner('');
                                setSplitMyPercentage(50);
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={() => {
                                if (!splitPartner) {
                                  alert('Velg hvem du vil dele med');
                                  return;
                                }
                                requestTaskSplit(selectedTaskForSplit.id, splitPartner, splitMyPercentage);
                                setSelectedTaskForSplit(null);
                                setSplitPartner('');
                                setSplitMyPercentage(50);
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Send forespÃ¸rsel
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* FASE 4: ForeslÃ¥ oppgave modal */}
                    {showTaskProposal && (
                      <div className="modal-overlay" onClick={() => setShowTaskProposal(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                            ðŸ’¡ ForeslÃ¥ oppgave
                          </h2>
                          <p style={{ marginBottom: '1rem', color: '#666' }}>
                            Beskriv oppgaven du vil gjÃ¸re og hvor mye du synes den er verdt.
                          </p>
                          
                          <input
                            type="text"
                            placeholder="Hva vil du gjÃ¸re?"
                            value={proposedTaskTitle}
                            onChange={(e) => setProposedTaskTitle(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '0.75rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          
                          <input
                            type="number"
                            placeholder="Hvor mye? (kr)"
                            value={proposedTaskAmount}
                            onChange={(e) => setProposedTaskAmount(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />

                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => {
                                setShowTaskProposal(false);
                                setProposedTaskTitle('');
                                setProposedTaskAmount('');
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={proposeTask}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Send forslag
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* FASE 4: SparemÃ¥l modal */}
                    {showSavingsGoalForm && (
                      <div className="modal-overlay" onClick={() => setShowSavingsGoalForm(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                            ðŸŽ¯ Nytt sparemÃ¥l
                          </h2>
                          
                          <input
                            type="text"
                            placeholder="Hva sparer du til?"
                            value={savingsGoalName}
                            onChange={(e) => setSavingsGoalName(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '0.75rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          
                          <input
                            type="number"
                            placeholder="Hvor mye koster det? (kr)"
                            value={savingsGoalAmount}
                            onChange={(e) => setSavingsGoalAmount(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />

                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => {
                                setShowSavingsGoalForm(false);
                                setSavingsGoalName('');
                                setSavingsGoalAmount('');
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={createSavingsGoal}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Opprett mÃ¥l
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Rediger oppgave modal (foreldre) */}
                    {editingTask && (
                      <div className="modal-overlay" onClick={() => setEditingTask(null)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                            âœï¸ Rediger oppgave
                          </h2>
                          
                          <input
                            type="text"
                            placeholder="Oppgavetittel"
                            value={editTaskTitle}
                            onChange={(e) => setEditTaskTitle(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '0.75rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />
                          
                          <input
                            type="number"
                            placeholder="BelÃ¸p (kr)"
                            value={editTaskAmount}
                            onChange={(e) => setEditTaskAmount(e.target.value)}
                            style={{
                              width: '100%',
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              marginBottom: '1rem',
                              outline: 'none',
                              boxSizing: 'border-box'
                            }}
                          />

                          <div style={{ display: 'flex', gap: '0.75rem' }}>
                            <button
                              onClick={() => {
                                setEditingTask(null);
                                setEditTaskTitle('');
                                setEditTaskAmount('');
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: '#e0e0e0',
                                border: 'none',
                                borderRadius: '15px',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Avbryt
                            </button>
                            <button
                              onClick={() => {
                                editTask(editingTask.id, editTaskTitle, editTaskAmount);
                                setEditingTask(null);
                                setEditTaskTitle('');
                                setEditTaskAmount('');
                              }}
                              style={{
                                flex: 1,
                                padding: '1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '15px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer'
                              }}
                            >
                              Lagre
                            </button>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Vis barns statistikk modal (foreldre) */}
                    {viewingChildStats && (
                      <div className="modal-overlay" onClick={() => setViewingChildStats(null)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                          <h2 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                            ðŸ“Š {viewingChildStats.emoji} {viewingChildStats.name} - Statistikk
                          </h2>
                          
                          {(() => {
                            const stats = getChildStats(viewingChildStats.name);
                            const balance = calculateBalance(viewingChildStats.name);
                            return (
                              <div>
                                <div style={{
                                  background: `${viewingChildStats.color}20`,
                                  padding: '1.5rem',
                                  borderRadius: '15px',
                                  marginBottom: '1.5rem',
                                  textAlign: 'center'
                                }}>
                                  <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem' }}>
                                    NÃ¥vÃ¦rende saldo
                                  </div>
                                  <div style={{ fontSize: '2.5rem', fontWeight: '700', color: viewingChildStats.color }}>
                                    {balance} kr
                                  </div>
                                </div>

                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem' }}>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>
                                      Denne uken
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: viewingChildStats.color }}>
                                      {stats.weekEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>
                                      Denne mÃ¥neden
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: viewingChildStats.color }}>
                                      {stats.monthEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>
                                      I Ã¥r
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: viewingChildStats.color }}>
                                      {stats.yearEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>
                                      Oppgaver utfÃ¸rt
                                    </div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: viewingChildStats.color }}>
                                      {stats.totalTasks}
                                    </div>
                                  </div>
                                </div>

                                <h3 style={{ marginBottom: '1rem', fontSize: '1.1rem' }}>Historikk</h3>
                                <div style={{ maxHeight: '300px', overflowY: 'auto' }}>
                                  {choreWorkers
                                    .filter(w => w.worker_name === viewingChildStats.name && w.approved_at)
                                    .sort((a, b) => new Date(b.approved_at) - new Date(a.approved_at))
                                    .map(worker => {
                                      const task = choreTasks.find(t => t.id === worker.task_id);
                                      return (
                                        <div
                                          key={worker.id}
                                          style={{
                                            padding: '0.8rem',
                                            background: '#f5f5f5',
                                            borderRadius: '10px',
                                            marginBottom: '0.5rem',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                          }}
                                        >
                                          <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: '600', fontSize: '0.95rem' }}>
                                              {task?.title}
                                            </div>
                                            <div style={{ fontSize: '0.8rem', color: '#666' }}>
                                              {new Date(worker.approved_at).toLocaleDateString('no-NO')}
                                            </div>
                                          </div>
                                          <div style={{ fontWeight: '700', color: viewingChildStats.color }}>
                                            +{worker.earned_amount} kr
                                          </div>
                                        </div>
                                      );
                                    })}
                                </div>

                                <button
                                  onClick={() => setViewingChildStats(null)}
                                  style={{
                                    width: '100%',
                                    marginTop: '1.5rem',
                                    padding: '1rem',
                                    background: '#e0e0e0',
                                    border: 'none',
                                    borderRadius: '15px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                  }}
                                >
                                  Lukk
                                </button>
                              </div>
                            );
                          })()}
                        </div>
                      </div>
                    )}
                  </div>
                ) : (
                  <div>
                    {/* Deling-forespÃ¸rsler (barn) */}
                    {currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine' && 
                     splitRequests.filter(r => r.partner_name === currentUser.name && r.status === 'pending').length > 0 && (
                      <div style={{ marginBottom: '1.5rem' }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          ðŸ¤ ForespÃ¸rsler om deling
                        </h3>
                        {splitRequests.filter(r => r.partner_name === currentUser.name && r.status === 'pending').map(request => {
                          const task = choreTasks.find(t => t.id === request.task_id);
                          return (
                            <div
                              key={request.id}
                              style={{
                                background: currentTheme.cardBg,
                                padding: '1.2rem',
                                borderRadius: '15px',
                                marginBottom: '0.75rem',
                                boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                              }}
                            >
                              <div style={{ marginBottom: '1rem' }}>
                                <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem' }}>
                                  {task?.title}
                                </div>
                                <div style={{ fontSize: '0.9rem', color: '#666' }}>
                                  {request.requester_name} vil dele oppgaven:
                                </div>
                                <div style={{ fontSize: '0.9rem', marginTop: '0.5rem' }}>
                                  â€¢ {request.requester_name}: {request.requester_percentage}% ({Math.round(task.amount * request.requester_percentage / 100)} kr)
                                </div>
                                <div style={{ fontSize: '0.9rem' }}>
                                  â€¢ {request.partner_name}: {request.partner_percentage}% ({Math.round(task.amount * request.partner_percentage / 100)} kr)
                                </div>
                              </div>
                              <div style={{ display: 'flex', gap: '0.75rem' }}>
                                <button
                                  onClick={() => rejectSplitRequest(request.id)}
                                  style={{
                                    flex: 1,
                                    padding: '0.7rem',
                                    background: '#ff6b6b',
                                    border: 'none',
                                    borderRadius: '10px',
                                    color: 'white',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                  }}
                                >
                                  AvslÃ¥
                                </button>
                                <button
                                  onClick={() => acceptSplitRequest(request.id)}
                                  style={{
                                    flex: 1,
                                    padding: '0.7rem',
                                    background: currentTheme.success,
                                    border: 'none',
                                    borderRadius: '10px',
                                    color: 'white',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                  }}
                                >
                                  Godta
                                </button>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    )}

                    {/* Foreldre: Godkjenn foreslÃ¥tte oppgaver */}
                    {(currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') && 
                     choreTasks.filter(t => t.status === 'pending_approval').length > 0 && (
                      <div style={{ marginBottom: '1.5rem' }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          ðŸ’¡ ForeslÃ¥tte oppgaver
                        </h3>
                        {choreTasks.filter(t => t.status === 'pending_approval').map(task => (
                          <div
                            key={task.id}
                            style={{
                              background: currentTheme.cardBg,
                              padding: '1.2rem',
                              borderRadius: '15px',
                              marginBottom: '0.75rem',
                              boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                            }}
                          >
                            <div style={{ marginBottom: '1rem' }}>
                              <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem' }}>
                                {task.title}
                              </div>
                              <div style={{ fontSize: '0.9rem', color: '#666' }}>
                                ForeslÃ¥tt av {task.created_by} â€¢ {task.amount} kr
                              </div>
                            </div>
                            <div style={{ display: 'flex', gap: '0.75rem' }}>
                              <button
                                onClick={() => rejectProposedTask(task.id)}
                                style={{
                                  flex: 1,
                                  padding: '0.7rem',
                                  background: '#ff6b6b',
                                  border: 'none',
                                  borderRadius: '10px',
                                  color: 'white',
                                  fontWeight: '600',
                                  cursor: 'pointer'
                                }}
                              >
                                AvslÃ¥
                              </button>
                              <button
                                onClick={() => approveProposedTask(task.id)}
                                style={{
                                  flex: 1,
                                  padding: '0.7rem',
                                  background: currentTheme.success,
                                  border: 'none',
                                  borderRadius: '10px',
                                  color: 'white',
                                  fontWeight: '600',
                                  cursor: 'pointer'
                                }}
                              >
                                Godkjenn
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}

                    {/* Dashboard for barn */}
                    {(currentUser.name === 'Emmie' || currentUser.name === 'Thelma' || currentUser.name === 'Elea') && (
                      <div style={{
                        background: currentTheme.cardBg,
                        padding: '1.5rem',
                        borderRadius: '20px',
                        marginBottom: '1.5rem',
                        boxShadow: '0 4px 15px rgba(0,0,0,0.1)'
                      }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor, display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                          <Icon type="sparkles" size={24} />
                          Oversikt
                        </h3>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                          {/* Tilgjengelige oppgaver */}
                          <div style={{
                            padding: '1rem',
                            background: '#e3f2fd',
                            borderRadius: '12px',
                            textAlign: 'center'
                          }}>
                            <div style={{ fontSize: '2rem', marginBottom: '0.3rem' }}>
                              {choreTasks.filter(t => t.status === 'available').length}
                            </div>
                            <div style={{ fontSize: '0.85rem', color: '#666', fontWeight: '600' }}>
                              Tilgjengelige
                            </div>
                          </div>

                          {/* Mine pÃ¥gÃ¥ende */}
                          <div style={{
                            padding: '1rem',
                            background: '#fff3e0',
                            borderRadius: '12px',
                            textAlign: 'center'
                          }}>
                            <div style={{ fontSize: '2rem', marginBottom: '0.3rem' }}>
                              {choreTasks.filter(t => 
                                t.status === 'in_progress' && 
                                choreWorkers.some(w => w.task_id === t.id && w.worker_name === currentUser.name)
                              ).length}
                            </div>
                            <div style={{ fontSize: '0.85rem', color: '#666', fontWeight: '600' }}>
                              Mine pÃ¥gÃ¥ende
                            </div>
                          </div>

                          {/* Venter godkjenning */}
                          <div style={{
                            padding: '1rem',
                            background: '#f3e5f5',
                            borderRadius: '12px',
                            textAlign: 'center'
                          }}>
                            <div style={{ fontSize: '2rem', marginBottom: '0.3rem' }}>
                              {choreTasks.filter(t => 
                                t.status === 'completed' && 
                                choreWorkers.some(w => w.task_id === t.id && w.worker_name === currentUser.name)
                              ).length}
                            </div>
                            <div style={{ fontSize: '0.85rem', color: '#666', fontWeight: '600' }}>
                              Venter svar
                            </div>
                          </div>

                          {/* Achievements */}
                          <div style={{
                            padding: '1rem',
                            background: '#fff9c4',
                            borderRadius: '12px',
                            textAlign: 'center'
                          }}>
                            <div style={{ fontSize: '2rem', marginBottom: '0.3rem' }}>
                              {achievements.filter(a => a.user_name === currentUser.name).length}
                            </div>
                            <div style={{ fontSize: '0.85rem', color: '#666', fontWeight: '600' }}>
                              Prestasjoner
                            </div>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Saldo oversikt for barn */}
                    {(currentUser.name === 'Emmie' || currentUser.name === 'Thelma' || currentUser.name === 'Elea') && (
                      <div>
                        <div style={{
                          background: `linear-gradient(135deg, ${currentUser.color}20 0%, ${currentUser.color}40 100%)`,
                          padding: '2rem',
                          borderRadius: '20px',
                          marginBottom: '1.5rem',
                          textAlign: 'center',
                          boxShadow: '0 4px 15px rgba(0,0,0,0.1)'
                        }}>
                          <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem' }}>Din saldo</div>
                          <div style={{ fontSize: '3rem', fontWeight: '700', color: currentUser.color }}>
                            {calculateBalance(currentUser.name)} kr
                          </div>
                          <button
                            onClick={() => setShowStatistics(!showStatistics)}
                            style={{
                              marginTop: '1rem',
                              padding: '0.5rem 1rem',
                              background: 'white',
                              border: 'none',
                              borderRadius: '10px',
                              fontWeight: '600',
                              cursor: 'pointer',
                              color: currentUser.color
                            }}
                          >
                            ðŸ“Š {showStatistics ? 'Skjul' : 'Vis'} statistikk
                          </button>
                        </div>

                        {/* Statistikk */}
                        {showStatistics && (
                          <div style={{
                            background: currentTheme.cardBg,
                            padding: '1.5rem',
                            borderRadius: '20px',
                            marginBottom: '1.5rem',
                            boxShadow: '0 4px 15px rgba(0,0,0,0.1)'
                          }}>
                            <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                              ðŸ“Š Din statistikk
                            </h3>
                            {(() => {
                              const stats = getChildStats(currentUser.name);
                              return (
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>Denne uken</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: currentUser.color }}>
                                      {stats.weekEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>Denne mÃ¥neden</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: currentUser.color }}>
                                      {stats.monthEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>I Ã¥r</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: currentUser.color }}>
                                      {stats.yearEarnings} kr
                                    </div>
                                  </div>
                                  <div style={{ textAlign: 'center', padding: '1rem', background: '#f5f5f5', borderRadius: '10px' }}>
                                    <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: '0.3rem' }}>Oppgaver utfÃ¸rt</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: currentUser.color }}>
                                      {stats.totalTasks}
                                    </div>
                                  </div>
                                </div>
                              );
                            })()}
                          </div>
                        )}

                        {/* SparemÃ¥l */}
                        <div style={{ marginBottom: '1.5rem' }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <h3 style={{ color: currentTheme.primaryColor }}>
                              ðŸŽ¯ Mine sparemÃ¥l
                            </h3>
                            <button
                              onClick={() => setShowSavingsGoalForm(true)}
                              style={{
                                padding: '0.5rem 1rem',
                                background: currentTheme.success,
                                border: 'none',
                                borderRadius: '10px',
                                color: 'white',
                                fontWeight: '600',
                                cursor: 'pointer',
                                fontSize: '0.85rem'
                              }}
                            >
                              + Nytt mÃ¥l
                            </button>
                          </div>
                          
                          {savingsGoals.filter(g => g.child_name === currentUser.name && !g.completed).length === 0 ? (
                            <div style={{
                              background: currentTheme.cardBg,
                              padding: '2rem',
                              borderRadius: '20px',
                              textAlign: 'center',
                              color: '#999'
                            }}>
                              <p>Ingen sparemÃ¥l ennÃ¥</p>
                            </div>
                          ) : (
                            savingsGoals.filter(g => g.child_name === currentUser.name && !g.completed).map(goal => {
                              const balance = calculateBalance(currentUser.name);
                              const progress = Math.min(100, Math.round((balance / goal.target_amount) * 100));
                              return (
                                <div
                                  key={goal.id}
                                  style={{
                                    background: currentTheme.cardBg,
                                    padding: '1.2rem',
                                    borderRadius: '15px',
                                    marginBottom: '0.75rem',
                                    boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                                  }}
                                >
                                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                                    <span style={{ fontWeight: '600' }}>{goal.goal_name}</span>
                                    <span style={{ fontWeight: '700', color: currentUser.color }}>
                                      {balance} / {goal.target_amount} kr
                                    </span>
                                  </div>
                                  <div style={{ 
                                    height: '10px', 
                                    background: '#e0e0e0', 
                                    borderRadius: '5px',
                                    overflow: 'hidden'
                                  }}>
                                    <div style={{
                                      width: `${progress}%`,
                                      height: '100%',
                                      background: currentUser.color,
                                      transition: 'width 0.3s ease'
                                    }} />
                                  </div>
                                  <div style={{ fontSize: '0.85rem', color: '#666', marginTop: '0.3rem', textAlign: 'right' }}>
                                    {progress}%
                                  </div>
                                </div>
                              );
                            })
                          )}
                        </div>
                      </div>
                    )}

                    {/* Foreldre: Opprett oppgave */}
                    {(currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') && (
                      <div style={{
                        background: currentTheme.cardBg,
                        padding: '1.5rem',
                        borderRadius: '20px',
                        boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                        marginBottom: '1.5rem'
                      }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          <Icon type="plus" size={20} style={{ marginRight: '0.5rem' }} />
                          Opprett oppgave
                        </h3>
                        <input
                          type="text"
                          placeholder="Hva skal gjÃ¸res?"
                          id="choreTitle"
                          style={{
                            width: '100%',
                            padding: '0.9rem',
                            border: '2px solid #ffd4c4',
                            borderRadius: '15px',
                            fontSize: '1rem',
                            marginBottom: '0.75rem',
                            outline: 'none',
                            boxSizing: 'border-box'
                          }}
                        />
                        <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '0.75rem' }}>
                          <input
                            type="number"
                            placeholder="BelÃ¸p (kr)"
                            id="choreAmount"
                            style={{
                              flex: 1,
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              outline: 'none'
                            }}
                          />
                          <select
                            id="choreType"
                            style={{
                              flex: 1,
                              padding: '0.9rem',
                              border: '2px solid #ffd4c4',
                              borderRadius: '15px',
                              fontSize: '1rem',
                              outline: 'none',
                              background: 'white'
                            }}
                          >
                            <option value="once">Engangs-oppgave</option>
                            <option value="weekly">Ukentlig oppgave</option>
                          </select>
                        </div>
                        <select
                          id="choreCategory"
                          style={{
                            width: '100%',
                            padding: '0.9rem',
                            border: '2px solid #ffd4c4',
                            borderRadius: '15px',
                            fontSize: '1rem',
                            outline: 'none',
                            background: 'white',
                            marginBottom: '0.75rem',
                            boxSizing: 'border-box'
                          }}
                        >
                          <option value="hjemme">ðŸ  Hjemme</option>
                          <option value="ute">ðŸŒ³ Ute</option>
                          <option value="kjaeledyr">ðŸ¾ KjÃ¦ledyr</option>
                          <option value="skole">ðŸ“š Skole</option>
                          <option value="spesielt">âœ¨ Spesielt</option>
                        </select>
                        <button
                          onClick={() => {
                            const title = document.getElementById('choreTitle').value;
                            const amount = document.getElementById('choreAmount').value;
                            const type = document.getElementById('choreType').value;
                            const category = document.getElementById('choreCategory').value;
                            if (title && amount) {
                              createChoreTask(title, amount, type, category);
                              document.getElementById('choreTitle').value = '';
                              document.getElementById('choreAmount').value = '';
                            }
                          }}
                          style={{
                            width: '100%',
                            padding: '1rem',
                            background: currentTheme.success,
                            border: 'none',
                            borderRadius: '15px',
                            color: 'white',
                            fontSize: '1rem',
                            fontWeight: '600',
                            cursor: 'pointer'
                          }}
                        >
                          Opprett oppgave
                        </button>
                      </div>
                    )}

                    {/* ForeslÃ¥ oppgave (barn) */}
                    {currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine' && (
                      <div style={{
                        background: currentTheme.cardBg,
                        padding: '1rem',
                        borderRadius: '20px',
                        boxShadow: '0 4px 15px rgba(0,0,0,0.1)',
                        marginBottom: '1.5rem',
                        textAlign: 'center'
                      }}>
                        <button
                          onClick={() => setShowTaskProposal(true)}
                          style={{
                            padding: '0.8rem 1.5rem',
                            background: currentTheme.success,
                            border: 'none',
                            borderRadius: '15px',
                            color: 'white',
                            fontSize: '1rem',
                            fontWeight: '600',
                            cursor: 'pointer'
                          }}
                        >
                          ðŸ’¡ ForeslÃ¥ en oppgave
                        </button>
                      </div>
                    )}

                    {/* Tilgjengelige oppgaver */}
                    <div style={{ marginBottom: '1.5rem' }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                        <h3 style={{ color: currentTheme.primaryColor, margin: 0 }}>
                          ðŸ“‹ Tilgjengelige oppgaver
                        </h3>
                        <select
                          value={selectedCategory}
                          onChange={(e) => setSelectedCategory(e.target.value)}
                          style={{
                            padding: '0.5rem 1rem',
                            border: `2px solid ${currentTheme.primaryColor}`,
                            borderRadius: '10px',
                            fontSize: '0.85rem',
                            fontWeight: '600',
                            background: 'white',
                            cursor: 'pointer',
                            outline: 'none'
                          }}
                        >
                          <option value="all">Alle</option>
                          <option value="hjemme">ðŸ  Hjemme</option>
                          <option value="ute">ðŸŒ³ Ute</option>
                          <option value="kjaeledyr">ðŸ¾ KjÃ¦ledyr</option>
                          <option value="skole">ðŸ“š Skole</option>
                          <option value="spesielt">âœ¨ Spesielt</option>
                        </select>
                      </div>
                      {choreTasks.filter(t => 
                        t.status === 'available' && 
                        (selectedCategory === 'all' || t.category === selectedCategory)
                      ).length === 0 ? (
                        <div style={{
                          background: currentTheme.cardBg,
                          padding: '2rem',
                          borderRadius: '20px',
                          textAlign: 'center',
                          color: '#999'
                        }}>
                          <p>Ingen tilgjengelige oppgaver i denne kategorien</p>
                        </div>
                      ) : (
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                          {choreTasks.filter(t => 
                            t.status === 'available' && 
                            (selectedCategory === 'all' || t.category === selectedCategory)
                          ).map(task => {
                            const categoryIcons = {
                              hjemme: 'ðŸ ',
                              ute: 'ðŸŒ³',
                              kjaeledyr: 'ðŸ¾',
                              skole: 'ðŸ“š',
                              spesielt: 'âœ¨'
                            };
                            return (
                              <div
                              key={task.id}
                              style={{
                                background: currentTheme.cardBg,
                                padding: '1.2rem',
                                borderRadius: '15px',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                              }}
                            >
                              <div style={{ flex: 1 }}>
                                <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                  <span>{categoryIcons[task.category] || 'ðŸ“‹'}</span>
                                  {task.title}
                                </div>
                                <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                  {task.task_type === 'weekly' ? 'ðŸ” Ukentlig' : 'âœ… Engangs'} â€¢ 
                                  Opprettet av {task.created_by}
                                </div>
                              </div>
                              <div style={{ textAlign: 'right' }}>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#4caf50', marginBottom: '0.5rem' }}>
                                  {task.amount} kr
                                </div>
                                {currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine' ? (
                                  <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                    <button
                                      onClick={() => takeChoreTask(task.id)}
                                      style={{
                                        padding: '0.6rem 1.2rem',
                                        background: currentTheme.accent,
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        fontSize: '0.9rem'
                                      }}
                                    >
                                      Ta oppgave
                                    </button>
                                    <button
                                      onClick={() => setSelectedTaskForSplit(task)}
                                      style={{
                                        padding: '0.5rem 1rem',
                                        background: 'white',
                                        border: `2px solid ${currentTheme.primaryColor}`,
                                        borderRadius: '10px',
                                        color: currentTheme.primaryColor,
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        fontSize: '0.85rem'
                                      }}
                                    >
                                      ðŸ‘¥ Del oppgave
                                    </button>
                                  </div>
                                ) : (
                                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button
                                      onClick={() => {
                                        setEditingTask(task);
                                        setEditTaskTitle(task.title);
                                        setEditTaskAmount(task.amount.toString());
                                      }}
                                      style={{
                                        padding: '0.5rem 0.8rem',
                                        background: '#ffa726',
                                        border: 'none',
                                        borderRadius: '8px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        fontSize: '0.85rem'
                                      }}
                                    >
                                      âœï¸
                                    </button>
                                    <button
                                      onClick={() => deleteTask(task.id)}
                                      style={{
                                        padding: '0.5rem 0.8rem',
                                        background: '#ff6b6b',
                                        border: 'none',
                                        borderRadius: '8px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        fontSize: '0.85rem'
                                      }}
                                    >
                                      ðŸ—‘ï¸
                                    </button>
                                  </div>
                                )}
                              </div>
                            </div>
                            );
                          })}
                        </div>
                      )}
                    </div>

                    {/* Mine pÃ¥gÃ¥ende oppgaver (barn) */}
                    {currentUser.name !== 'Kim Rune' && currentUser.name !== 'Katrine' && (
                      <div style={{ marginBottom: '1.5rem' }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          â³ Mine pÃ¥gÃ¥ende oppgaver
                        </h3>
                        {choreTasks.filter(t => 
                          t.status === 'in_progress' && 
                          choreWorkers.some(w => w.task_id === t.id && w.worker_name === currentUser.name && !w.completed_at)
                        ).length === 0 ? (
                          <div style={{
                            background: currentTheme.cardBg,
                            padding: '2rem',
                            borderRadius: '20px',
                            textAlign: 'center',
                            color: '#999'
                          }}>
                            <p>Ingen pÃ¥gÃ¥ende oppgaver</p>
                          </div>
                        ) : (
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            {choreTasks.filter(t => 
                              t.status === 'in_progress' && 
                              choreWorkers.some(w => w.task_id === t.id && w.worker_name === currentUser.name && !w.completed_at)
                            ).map(task => (
                              <div
                                key={task.id}
                                style={{
                                  background: currentTheme.cardBg,
                                  padding: '1.2rem',
                                  borderRadius: '15px',
                                  boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                                }}
                              >
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <div style={{ flex: 1 }}>
                                    <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem' }}>
                                      {task.title}
                                    </div>
                                    <div style={{ fontSize: '1.3rem', fontWeight: '700', color: '#4caf50' }}>
                                      {task.amount} kr
                                    </div>
                                  </div>
                                  <button
                                    onClick={() => completeChoreTask(task.id)}
                                    style={{
                                      padding: '0.7rem 1.3rem',
                                      background: currentTheme.success,
                                      border: 'none',
                                      borderRadius: '10px',
                                      color: 'white',
                                      fontWeight: '600',
                                      cursor: 'pointer'
                                    }}
                                  >
                                    âœ“ Ferdig
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    )}

                    {/* Oppgaver som venter pÃ¥ godkjenning (foreldre) */}
                    {(currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') && (
                      <div style={{ marginBottom: '1.5rem' }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          â° Venter pÃ¥ godkjenning
                        </h3>
                        {choreTasks.filter(t => t.status === 'completed').length === 0 ? (
                          <div style={{
                            background: currentTheme.cardBg,
                            padding: '2rem',
                            borderRadius: '20px',
                            textAlign: 'center',
                            color: '#999'
                          }}>
                            <p>Ingen oppgaver venter pÃ¥ godkjenning</p>
                          </div>
                        ) : (
                          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            {choreTasks.filter(t => t.status === 'completed').map(task => {
                              const worker = choreWorkers.find(w => w.task_id === task.id && w.completed_at);
                              return (
                                <div
                                  key={task.id}
                                  style={{
                                    background: currentTheme.cardBg,
                                    padding: '1.2rem',
                                    borderRadius: '15px',
                                    boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                                  }}
                                >
                                  <div style={{ marginBottom: '1rem' }}>
                                    <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem' }}>
                                      {task.title}
                                    </div>
                                    <div style={{ fontSize: '0.85rem', color: '#666' }}>
                                      UtfÃ¸rt av {worker?.worker_name} â€¢ {task.amount} kr
                                    </div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '0.75rem' }}>
                                    <button
                                      onClick={() => rejectChoreTask(task.id)}
                                      style={{
                                        flex: 1,
                                        padding: '0.7rem',
                                        background: '#ff6b6b',
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer'
                                      }}
                                    >
                                      âœ— Avvis
                                    </button>
                                    <button
                                      onClick={() => approveChoreTask(task.id)}
                                      style={{
                                        flex: 1,
                                        padding: '0.7rem',
                                        background: currentTheme.success,
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer'
                                      }}
                                    >
                                      âœ“ Godkjenn
                                    </button>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </div>
                    )}

                    {/* Saldo oversikt for foreldre */}
                    {(currentUser.name === 'Kim Rune' || currentUser.name === 'Katrine') && (
                      <div style={{ marginBottom: '1.5rem' }}>
                        <h3 style={{ marginBottom: '1rem', color: currentTheme.primaryColor }}>
                          ðŸ’° Saldo oversikt
                        </h3>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                          {['Emmie', 'Thelma', 'Elea'].map(childName => {
                            const child = users.find(u => u.name === childName);
                            const balance = calculateBalance(childName);
                            return (
                              <div
                                key={childName}
                                style={{
                                  background: currentTheme.cardBg,
                                  padding: '1.2rem',
                                  borderRadius: '15px',
                                  display: 'flex',
                                  justifyContent: 'space-between',
                                  alignItems: 'center',
                                  boxShadow: '0 2px 10px rgba(0,0,0,0.05)'
                                }}
                              >
                                <div>
                                  <div style={{ fontSize: '1.1rem', fontWeight: '600', marginBottom: '0.3rem' }}>
                                    {child.emoji} {childName}
                                  </div>
                                  <div style={{ fontSize: '1.5rem', fontWeight: '700', color: child.color }}>
                                    {balance} kr
                                  </div>
                                </div>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                  <button
                                    onClick={() => setViewingChildStats(child)}
                                    style={{
                                      padding: '0.7rem 1rem',
                                      background: 'white',
                                      border: `2px solid ${child.color}`,
                                      borderRadius: '10px',
                                      color: child.color,
                                      fontWeight: '600',
                                      cursor: 'pointer',
                                      fontSize: '0.9rem'
                                    }}
                                  >
                                    ðŸ“Š Statistikk
                                  </button>
                                  {balance > 0 && (
                                    <button
                                      onClick={() => payoutBalance(childName)}
                                      style={{
                                        padding: '0.7rem 1.3rem',
                                        background: currentTheme.accent,
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: 'white',
                                        fontWeight: '600',
                                        cursor: 'pointer'
                                      }}
                                    >
                                      ðŸ’¸ Utbetal
                                    </button>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    )}

                    {/* Logg ut knapp */}
                    <div style={{ textAlign: 'center', marginTop: '2rem' }}>
                      <button
                        onClick={() => {
                          setAllowanceAuth(null);
                          setActiveTab('shopping');
                        }}
                        style={{
                          padding: '0.7rem 1.5rem',
                          background: '#e0e0e0',
                          border: 'none',
                          borderRadius: '10px',
                          fontWeight: '600',
                          cursor: 'pointer',
                          color: '#666'
                        }}
                      >
                        <Icon type="lock" size={16} style={{ marginRight: '0.5rem' }} />
                        Logg ut av UkelÃ¸nn
                      </button>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>

          <div style={{ padding: '1.5rem', textAlign: 'center', color: 'rgba(139, 69, 19, 0.7)', fontSize: '0.85rem' }}>
            <p style={{ margin: '0' }}>ðŸ’¡ Alt deles med hele familien</p>
          </div>
        </div>
      );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FamilieApp />);
  </script>
</body>
</html>
